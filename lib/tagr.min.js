/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var i=null,q=!1,G=function(){function H(){var a;a=function(){var a;if(l.querySelector!=i)return function(a,b){return a.querySelectorAll(b)};if(l.documentElement.currentStyle!=i)return a=new w,function(c,d){var e,j;e=(j=d.match(x))!=i?j[1]:void 0;a.addRule(d,"foo:bar");var f,g,h;g=e?c.all.S(e):c.all;h=[];j=0;for(f=g.length;j<f;j++)e=g[j],"bar"===e.currentStyle.J&&h.push(e);a.removeRule(0);return h}};return function(b,c){return"undefined"!==typeof Sizzle?Sizzle(c,b):a()}}function y(){var a,b,c,d,e,
j,f,g,h;j=arguments[0];d=arguments[1];c=arguments[2];a=4<=arguments.length?[].slice.call(arguments,3):[];if(0>d||isNaN(d))throw"Invalid index";if(c){f=[];for(e=b=0;0<=c?b<c:b>c;e=0<=c?++b:--b)f.push(j[d+e]),delete j[d+e]}if(c>a.length){e=b=d+c;for(g=j.length;b<g;e=b+=1)j[e-c]=j[e]}else if(a.length>c)for(e=b=j.length+(a.length-c)-1;b>d;e=b+=-1)j[e]=j[e-(a.length-c)];if(a.length){e=g=0;for(h=a.length;g<h;e=++g)b=a[e],j[d+e]=b}j.length+=-c+a.length;return f}function z(a){return a.toLowerCase().replace(/\-[a-z]/g,
function(a){return a[1].toUpperCase()})}function t(a,b){function c(){this.constructor=a}c.prototype=b.prototype;a.prototype=new c}function A(a){return function(b,c){if("object"===typeof b){for(var d in b)a.call(this,d,b[d]);return this}return a.call(this,b,c)}}function B(a){return function(b,c){if("[object Array]"===Object.prototype.toString.call(b)){var d=this;b.forEach(function(b){a.call(d,b,c)});return this}return a.call(this,b,c)}}function C(a){return function(b,c){if("[object Array]"===Object.prototype.toString.call(c)){var d=
this;c.forEach(function(c){a.call(d,b,c)});return this}return a.call(this,b,c)}}function D(a){var b;if(b=a.match(x)){a={c:b[1]||"div",n:[],id:i};b=b[2].match(I)||[];for(var c=0,d=b.length;c<d;c++)switch(b[c].charAt(0)){case "#":a.id=b[c].substr(1);break;case ".":a.n.push(b[c].substr(1))}return a}}function h(){}function r(){this.m={}}function w(a){var b=l.createElement("style");b.type="text/css";b.media=a||"all";l.getElementsByTagName("head")[0].appendChild(b);return b.sheet||b.styleSheet}function g(a,
b){if("string"!=typeof a)throw new Exception("Invalid tag or selector argument passed to tagr.create: "+a);var c=D(a||""),d=l.createElement(c.c);c.n.length&&(d.className=c.n.join(" "));c.id&&(d.id=c.id);c=new f(d);c.set(b||{});2<arguments.length&&c.push.apply(c,[].slice.call(arguments,2));return c}function o(a){this.push.apply(this,a.className?a.className.replace(/^\s+|\s+$/g,"").split(/\s+/):[]);this.s=function(){node.className=this.toString()}}var m,l,p=function(){var a={"&":"&amp;","<":"&lt;",
">":"&gt;",'"':"&#34;","'":"&#39;"};return function(b){return b.replace(/[&<>'"]/g,function(b){return a[b]})}}(),k={"for":"htmlFor",accesskey:"accessKey",codebase:"codeBase",frameborder:"frameBorder",framespacing:"frameSpacing",nowrap:"noWrap",maxlength:"maxLength","class":"className",readonly:"readOnly",longdesc:"longDesc",tabindex:"tabIndex",rowspan:"rowSpan",colspan:"colSpan",enctype:"encType",ismap:"isMap",usemap:"useMap",cellpadding:"cellPadding",cellspacing:"cellSpacing"},J="area,base,br,col,command,embed,hr,img,input,keygen,link,meta,param,source,track,wbr".split(","),
u=i,s=function(){var a;a=0;return function(b){var c;return(c=b.C)!=i?c:b.C=a++}}(),x=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/,I=/([:#.]+)([^:#.]+)/g;h.prototype.listeners=function(a){this.d=this.d?this.d:{};return Object.prototype.hasOwnProperty.call(this.d,a)?this.d[a]:this.d[a]=[]};h.prototype.on=function(){return this.F.apply(this,[].slice.call(arguments,0))};h.prototype.once=function(a,b){function c(){b.apply(this,[].slice.call(arguments,0));return this.Q(a,c)}return this.B(a,c)};h.prototype.addListener=
function(a,b){this.i(a).push(b)>this.k&&0!==this.k&&"undefined"!==typeof console&&console.warn("Possible EventEmitter memory leak detected. "+this.d[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");this.t("newListener",a,b);return this};h.prototype.removeListener=function(a,b){var c=this.i(a).indexOf(b);-1!==c&&this.i(a).splice(c,1);return this};h.prototype.removeAllListeners=function(a){var b,c,d=this.d||{};for(b in d)c=d[b],(a==i||a===b)&&c.splice(0,c.length);return this};
h.prototype.emit=function(){for(var a=arguments[0],b=0,c=this.i(a);b<c.length;b++)c[b].apply(this,[].slice.call(arguments,1));return 0<this.i(a).length};h.prototype.k=10;h.prototype.setMaxListeners=function(a){this.k=a};r.prototype.set=function(a,b){return this.m[s(a)]=b};r.prototype.get=function(a){return this.m[s(a)]};r.prototype.remove=function(a){return delete this.m[s(a)]};g.create=g;g.D=["data-tagr"];g.parse=function(a){var b,c,d,e,f;if("string"===typeof a)return a;e=a[0];d=a[1];c=3<=a.length?
[].slice.call(a,2):[];return(f=g(e,d)).push.apply(f,function(){var a,d,e;e=[];a=0;for(d=c.length;a<d;a++)b=c[a],e.push(g.parse(b));return e}())};g.ready=function(){function a(){var a;for(g=1;a=b.shift();)a()}var b=[],c,d=l,e=d.documentElement,f=e.doScroll,g=/^loade|^c/.test(d.readyState);d.addEventListener&&d.addEventListener("DOMContentLoaded",c=function(){d.removeEventListener("DOMContentLoaded",c,q);a()},q);f&&d.attachEvent("onreadystatechange",c=function(){/^c/.test(d.readyState)&&(d.detachEvent("onreadystatechange",
c),a())});(ready=f?function(a){self!=top?g?a():b.push(a):function(){try{e.doScroll("left")}catch(b){return setTimeout(function(){ready(a)},50)}a()}()}:function(a){g?a():b.push(a)})()};g.h=new r;g.g=function(a,b){if(1!==a.nodeType)throw Error("Cannot create Tagr context of non-element");var c;if((c=g.h.get(a))==i){if(!b)throw Error("No Tagr wrapper exists for this element.");g.h.set(a,c=new f(a))}return c};g.getContext=function(a){return g.g(a,!0)};g.writeContext=function(a,b){var c=D(a||"");l.write("<"+
c.c+"></"+c.c+">");c=l.getElementsByTagName(c.c);c=g.getContext(c[c.length-1]);c.set(b||{});c.push.apply(c,[].slice.call(arguments,2));return c};t(o,Array);o.prototype.item=function(a){return this[a]||i};o.prototype.contains=function(a){return-1!==[].indexOf.call(this,""+a)};o.prototype.add=function(a){this.contains(a)||(this.push(""+a),this.s())};o.prototype.remove=function(a){var b=0;if(-1!==(b=[].indexOf.call(this,""+a)))this.splice(b,1),this.s()};o.prototype.toggle=function(a){this.contains(""+
a)?this.add(a):this.remove(a)};o.prototype.toString=function(){return this.join(" ")};var v={input:["value"]},f=g.TagrElement=function(a,b){this.a=a;this.parent=b;this.tag=this.a.nodeName.toLowerCase();this.classList=new o(a);this.e={};this.b={};if(v[this.c])for(var c=0;c<v[this.c].length;c++)this.P(v[this.c][c]);var d=this.a.childNodes;this.length=d.length;for(c=0;c<this.length;c++){var e=d[c];this[c]=1===e.nodeType?new f(e,this):e.nodeValue}};t(f,h);f.prototype.u=function(a){this.parent=a;g.h.set(this.a,
this)};f.prototype.v=function(){delete this.parent;g.h.remove(this.a)};f.prototype.l="";f.prototype.r=function(){this.l||(this.a.className+=" "+(this.l="tagr-"+s(this.a)));return this.l};f.prototype.style=A(B(C(function(a,b){this.addRule(a,b);return this})));f.prototype.rules=function(){for(var a={},b=0;b<this.a.style.length;b++)a[this.a.style[b]]=this.a.style[this.a.style[b]];return a};f.prototype.addRule=function(a,b){try{this.a.style[z(a)]=b.replace(/^\s+|\s+$/g,"")}catch(c){}return this};f.prototype.removeRule=
function(a){return this.addRule(a,"")};f.prototype.get=function(a){return(k[a]||a)in this.a?this.a[k[a]||a]:this.e[a]};f.prototype.set=A(B(C(function(a,b){this.t("change:"+a,b);(k[a]||a)in this.a?this.a[k[a]||a]=b:this.e[a]=b;return this})));f.prototype.remove=function(a){this.t("change:"+a);return(k[a]||a)in this.a?delete this.a[k[a]||a]:delete this.e[a]};f.prototype.properties=function(){for(var a=JSON.parse(JSON.stringify(this.e)),b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];
a[c.name]=this.a[k[c.name]||c.name]}for(var d in this.b)Object.prototype.hasOwnProperty.call(this.b,d)&&this.b[d]&&(a[d]=this.a[k[d]||d]);return a};f.prototype.persist=function(a){this.b[a]=!0};f.prototype.stopPersisting=function(a){this.b[a]=q};f.prototype.addListener=function(a,b){var c=this;this.a.addEventListener?this.a.addEventListener(a,function(b){return c.emit(a,b)},q):this.a.attachEvent&&this.a.attachEvent("on"+a,function(){return c.emit(a,m.event)});return h.prototype.addListener.call(this,
a,b)};f.prototype.splice=function(){var a,b,c,d,e,f,h,k;c=arguments[0];b=arguments[1];a=3<=arguments.length?[].slice.call(arguments,2):[];for(d=e=0;0<=b?e<b:e>b;d=0<=b?++e:--e)this.a.removeChild(this.a.childNodes[c]),"object"===typeof this[c+d]&&this[c+d].v();f=this.a.childNodes[c]||i;d=h=0;for(k=a.length;h<k;d=++h){e=a[d];"object"===typeof e?(e.constructor===Array&&(e=a[d]=g.parse(e)),d=e.a):d=l.createTextNode(e);if(d.parentNode&&1===d.parentNode.nodeType)throw Error("Must remove element before appending elsewhere.");
this.a.insertBefore(d,f);"object"===typeof e&&e.u(this)}return y.apply(i,[this,c,b].concat([].slice.call(a)))};f.prototype.push=function(){return this.A.apply(this,[this.length].concat([].slice.call(arguments)))};f.prototype.pop=function(){return this.remove(this.length-1)};f.prototype.unshift=function(){return this.A.apply(this,[0].concat(arguments))};f.prototype.shift=function(){return this.remove(0)};f.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1};
[].forEach.call("slice,sort,reverse,forEach,map,every,lastIndexOf,filter,some,reduce,reduceRight".split(","),function(a){f.prototype[a]=function(){return Array.prototype[a].apply(this,arguments)}});f.prototype.insert=function(a){this.splice.apply(this,[a,0].concat([].slice.call(arguments,1)));return this.length};f.prototype.remove=function(a){return this.splice(a,1)[0]};f.prototype.empty=function(){this.splice(0,this.length);return this.length};f.prototype.insertSelf=function(a,b){a.insert(b,this);
return this};f.prototype.removeSelf=function(){this.parent.remove(this.index());return this};f.prototype.index=function(){return this.parent.indexOf(this)};f.prototype.spliceText=function(a,b,c,d){if("string"!==typeof this[a])throw Error("Cannot splice non-text node.");this.a.childNodes[a].replaceData(b,c,d||"");this[a]=this.a.childNodes[a].data;return this};f.prototype.splitText=function(a,b){if("string"!==typeof this[a])throw Error("Cannot split non-text node.");this.a.childNodes[a].splitText(b);
return y(this,a,1,this[a].substr(0,b),this[a].substr(b))};f.prototype.query=function(a){return new g.TagrQuery(this,a)};f.prototype.findAll=function(a){return this.query(a).findAll()};f.prototype.find=function(a){return this.query(a).find()};f.prototype.toJSON=function(){var a={},b;for(b in this.b)Object.prototype.hasOwnProperty.call(this.b,b)&&this.b[b]&&(a[b]=this.a[k[b]||b]);for(b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];this.b[c.name]!==q&&(a[c.name]=this.a[k[c.name]||c.name])}b=
[].map.call(this,function(a){return"string"===typeof a?a:a.toJSON()});return[this.c,a].concat(b)};f.prototype.toHTML=function(){var a=["<"+this.c],b;for(b in this.e)Object.prototype.hasOwnProperty.call(this.e,b)&&a.push(" "+p(b)+'="'+p(""+this.e[b])+'"');for(b in this.b)this.b[b]&&!(b in this.a.attributes)&&a.push(" "+p(b)+'="'+p(""+this.a[b])+'"');for(b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b],d=this.a[k[c.name]||c.name];a.push(" "+p(c.name)+'="'+p(""+d)+'"')}a.push(">");if(-1==
[].indexOf.call(J,this.c)){for(b=0;b<this.length;b++)a.push("string"==typeof this[b]?p(this[b]):this[b].T());a.push("</"+this.c+">")}return a.join("")};g.TagrQuery=function(){function a(a,b){this.f=a;this.j=b}var b={};t(a,h);a.prototype.style=function(a,d){var e;e==i&&(e="all");e=b[e]!=i?b[e]:b[e]=new w(e);e.insertRule!=i?e.insertRule("."+this.f.r()+" "+this.j+" { "+a+": "+d+" }",e.cssRules.length):e.addRule("."+this.f.r()+" "+this.j,""+a+": "+d);return this};a.prototype.addListener=function(a,b){var e=
this;this.f.B(a,function(a){var c,f;c=u(e.f.a,e.j);n=a.target||a.srcElement;for(f=[];n!==e.f.a&&n;)0<=[].indexOf.call(c,n)&&b.call(g.g(n),a),f.push(n=n.parentNode);return f},q);return h.prototype.addListener.call(this,a,b)};a.prototype.find=function(){return this.I()[0]};a.prototype.findAll=function(){var a,b,e,f,h;f=u(this.f.a,this.j);h=[];b=0;for(e=f.length;b<e;b++)a=f[b],h.push(g.g(a));return h};return a}();var E=g.ElementAnchor=function(a,b){this.p=a;this.o=b};E.prototype.q=function(){return[this.p.a,
this.o]};var F=g.TextAnchor=function(a,b,c){this.p=a;this.z=b;this.o=c};F.prototype.q=function(){return[this.p.a.childNodes[this.z],this.o]};convertAnchor=function(a){var b,c;c=a[0];a=a[1];if(1===c.nodeType)return!(b=g.g(c))?void 0:new E(b,a);if(g.g(c.parentNode)){b=0;for(n=c;n.previousSibling;)n=n.previousSibling,b++;return new F(el,b,a)}};g.view={getBox:function(a,b){var c,d,e,f;c=a.a.getBoundingClientRect();if(b!=i)for(d in f=b.a.getBoundingClientRect(),f)e=f[d],c[d]-=e;return c},getStyle:function(a,
b){var c;var d=a.a,e,f;m.getComputedStyle?(d=d.ownerDocument.defaultView.getComputedStyle(d,i),c=d!=i?d.getPropertyValue(b):void 0,c="opacity"===b&&""===c?"1":c):d.currentStyle&&(c=(e=d.currentStyle[b])!=i?e:d.currentStyle[z(b)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(f=[d.style.left,d.runtimeStyle.left],e=f[0],f=f[1],d.runtimeStyle.left=d.currentStyle.left,d.style.left="font-size"===b?"1em":c||0,c=d.style.pixelLeft+"px",e=[e,f],d.style.left=e[0],d.runtimeStyle.left=e[1]));return c},selection:{has:function(){return Selection.O(m)},
getOrigin:function(){return convertAnchor(Selection.M(m))},getFocus:function(){return convertAnchor(Selection.L(m))},getStart:function(){return convertAnchor(Selection.N(m))},getEnd:function(){return convertAnchor(Selection.K(m))},set:function(a,b){return Selection.R.apply(Selection,[m].concat([].slice.call(a.q()),[].slice.call(b.q())))},remove:function(){return Selection.G(m)}}};f.prototype.useWhitespace=function(a){a==i&&(a=!0);return a?this.style({"white-space":["pre","pre-wrap","-moz-pre-wrap",
"-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style(["white-space","word-wrap"],"")};f.prototype.setSelectable=function(a){a==i&&(a=!0);return this.style("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),a?"":"none")};g.w=function(a){m=a;l=a.document;u=H()};return g}();"undefined"!==typeof module?module.H=G:this.self&&G.w(this.self);
