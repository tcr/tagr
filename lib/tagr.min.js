/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var h=null;
(function(){function C(b,a){function c(){this.constructor=b}for(var e in a)I.call(a,e)&&(b[e]=a[e]);c.prototype=a.prototype;b.prototype=new c;b.s=a.prototype}var p,q,v,w,D,x,y,r,s,E,n,z,t,F,G,g,o,A,u,H,B,m=[].slice,I={}.hasOwnProperty;v=function(){function b(){}b.name="EventEmitter";b.prototype.f=function(a){return this.hasOwnProperty.call(this.c!=h?this.c:this.c={},a)?this.c[a]:this.c[a]=[]};b.prototype.m=function(){var a,c,b,d,f,i;b=arguments[0];a=2<=arguments.length?m.call(arguments,1):[];i=this.f(b);
d=0;for(f=i.length;d<f;d++)c=i[d],c.apply(this,a);this.f(b)};return b}();t=function(b){return function(a,c){var e,d;if(!(1<arguments.length)){for(e in a)d=a[e],b.call(this,e,d);return this}return b.call(this,a,c)}};z=function(b){return function(a,c){var e,d,f;if("object"===typeof a&&(a!=h?a.length:void 0)!=h){d=0;for(f=a.length;d<f;d++)e=a[d],b.call(this,e,c);return this}return b.call(this,a,c)}};A=function(b){return function(a,c){var e,d,f;if("object"===typeof c&&(c!=h?c.length:void 0)!=h){d=0;for(f=
c.length;d<f;d++)e=c[d],b.call(this,a,e);return this}return b.call(this,a,c)}};p=function(){function b(a,c){var b,d;c==h&&(c={});b={};this.length=0;d=function(a,c){return function(){return c.apply(a,arguments)}};this.get=d(a,function(a){return(c!=h?c.get:void 0)!=h?c.get(a):b["@"+a]});this.set=d(a,t(z(A(function(a,d){Object.prototype.hasOwnProperty.call(b,"@"+a)||(this[this.length++]=a);c!=h&&"function"===typeof c.set&&c.set(a,d);b["@"+a]=d;return this}))));this.remove=d(a,function(a){var d,j,k,g;
if(!Object.prototype.hasOwnProperty.call(b,"@"+a)){d=k=0;for(g=this.length;k<g;d=++k)if(j=this[d],j===a){j=k=d;for(g=this.length-1;d<=g?k<g:k>g;j=d<=g?++k:--k)this[j]=this[j+1];break}this.length--;c!=h&&"function"===typeof c.remove&&c.remove(a);delete b["@"+a]}return this})}b.name="ArrayHash";return b}();o=function(b){return b.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})};G=function(){var b,a,c,e,d,f,i,j,g;f=arguments[0];e=arguments[1];c=arguments[2];b=4<=arguments.length?
m.call(arguments,3):[];if(0>e||isNaN(e))throw"Invalid index";if(c){i=[];for(d=a=0;0<=c?a<c:a>c;d=0<=c?++a:--a)i.push(f[e+d]),delete f[e+d]}if(c>b.length){d=a=j=e+c;for(g=f.length;j<=g?a<g:a>g;d=j<=g?++a:--a)f[d-c]=f[d]}else if(b.length>c)for(d=a=j=f.length+b.length-1;j<=e?a<e:a>e;d=j<=e?++a:--a)f[d]=f[d-b.length];if(b.length){d=j=0;for(g=b.length;j<g;d=++j)a=b[d],f[e+d]=a}f.length+=-c+b.length;return i};y=function(b){var a;b==h&&(b="all");a=document.createElement("style");a.type="text/css";a.media=
b;return document.getElementsByTagName("head")[0].appendChild(a)};w={"for":"htmlFor",u:"accessKey",z:"codeBase",C:"frameBorder",D:"frameSpacing",K:"noWrap",J:"maxLength","class":"className",L:"readOnly",I:"longDesc",O:"tabIndex",N:"rowSpan",A:"colSpan",enctype:"encType",H:"isMap",Q:"useMap",v:"cellPadding",w:"cellSpacing"};s=function(){var b,a,c,e;e=/^loade|c/.test(document.readyState);c=[];b=function(a){var b;e=!0;for(b=[];a=c.shift();)b.push(a());return b};if(document.documentElement.doScroll)return document.attachEvent("onreadystatechange",
a=function(){if(/^c/.test(document.readyState))return document.detachEvent("onreadystatechange",a),b()}),function(a){return self!==top?e?a():c.push(a):function(){try{testEl.doScroll("left")}catch(c){return setTimeout(function(){return ready(a)},50)}return a()}()};if(document.addEventListener!=h)return document.addEventListener("DOMContentLoaded",a=function(){document.removeEventListener("DOMContentLoaded",a,!1);return b()},!1),function(a){return e?a():c.push(a)}}();E=function(b,a){var c,e,d;if(window.getComputedStyle)return c=
b.ownerDocument.defaultView.getComputedStyle(b,h),c=c!=h?c.getPropertyValue(a):void 0,"opacity"===a&&""===c?"1":c;if(b.currentStyle)return c=(e=b.currentStyle[a])!=h?e:b.currentStyle[o(a)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(d=[b.style.left,b.runtimeStyle.left],e=d[0],d=d[1],b.runtimeStyle.left=b.currentStyle.left,b.style.left="font-size"===a?"1em":c||0,c=b.style.pixelLeft+"px",e=[e,d],b.style.left=e[0],b.runtimeStyle.left=e[1]),c};(function(){var b;if(document.querySelector!=h)return function(a,
c){return a.querySelectorAll(c)};if(document.documentElement.currentStyle!=h)return b=new y,function(a,c){var e,d;e=(d=c.match(x))!=h?d[1]:void 0;b.addRule(c,"foo:bar");var f,i,g;i=e?a.P(e):a.all;g=[];d=0;for(f=i.length;d<f;d++)e=i[d],"bar"===e.currentStyle.B&&g.push(e);b.removeRule(0);return g}})();n=function(){var b;b=0;return function(a){var c;return(c=a.o)!=h?c:a.o=b++}}();q=function(){function b(){this.e={}}b.name="DomMap";b.prototype.set=function(a,c){return this.e[n(a)]=c};b.prototype.get=
function(a){return this.e[n(a)]};b.prototype.remove=function(a){return delete this.e[n(a)]};return b}();x=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/;D=/([:#.]+)([^:#.]+)/g;F=function(b){var a,c,e,d;if(a=b.match(x)){b={g:a[1]||"div",b:[],id:h};d=a[2].match(D)||[];c=0;for(e=d.length;c<e;c++)switch(a=d[c],a[0]){case "#":b.id=a.substr(1);break;case ".":b.b.push(a.substr(1))}return b}};g=function(){var b;b=1<=arguments.length?m.call(arguments,0):[];return g.create.apply(g,b)};g.p=["data-tagr"];g.create=function(b,
a){var c,e;a==h&&(a={});e=F(b||"");c=document.createElement(e.g);e.b.length&&(c.className=e.b.join(" "));e.id&&(c.id=e.id);return(new r(c)).set(a)};g.parse=function(b){var a,c,e,d,f;if("string"===typeof b)return b;d=b[0];e=b[1];c=3<=b.length?m.call(b,2):[];return(f=g.create(d,e)).append.apply(f,function(){var b,d,e;e=[];b=0;for(d=c.length;b<d;b++)a=c[b],e.push(g.parse(a));return e}())};g.M=s;g.d=new q;g.k=function(b){var a=!0,c;a==h&&(a=!1);if(1!==b.nodeType)throw Error("Cannot create Tagr context of non-element");
if((c=g.d.get(b))==h){if(!a)throw Error("No Tagr wrapper exists for this element.");g.d.set(b,c=new r(b))}return c};g.getContext=function(b){return g.k(b)};g.R=function(b,a){var c;b==h&&(b="div");a==h&&(a={});document.write("<"+b+"></"+b+">");c=document.getElementsByTagName(b);return g.getContext(c[c.length-1]).set(a)};g.q=r=function(b){function a(b,e){var d,f,g,j,k,l=this;this.a=b;this.parent=e;this.g=this.a.nodeName.toLowerCase();this.b=new p(this,{set:function(a,b){var c;b==h&&(b=!0);return l.a.className=
function(){var b,d,e,f;e=this.b;f=[];b=0;for(d=e.length;b<d;b++)c=e[b],c!==a&&f.push(c);return f}.call(l).join("")+(b?" "+a:"")},get:function(a){return!!l.a.className.match(RegExp("\\b"+a+"\\b"))},remove:function(a){var b;return l.a.className=function(){var c,d,e,f;e=this.b;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],b!==a&&f.push(b);return f}.call(l).join("")}});j=this.a.className.match(/\S+/g)||[];f=0;for(g=j.length;f<g;f++)d=j[f],this.b.set(d);this.style=new p(this,{set:function(a,b){return l.a.style[o(a)]=
b},get:function(a){return l.a.style[o(a)]},remove:function(a){return delete l.a.style[o(a)]}});this.length=this.a.childNodes.length;k=this.a.childNodes;f=g=0;for(j=k.length;g<j;f=++g)d=k[f],this[f]=1===d.nodeType?new a(d,this):d.t}C(a,b);a.name="TagrElement";a.prototype.h=function(a){this.parent=a;g.d.set(this.a,this)};a.prototype.i=function(){delete this.parent;g.d.remove(this.a)};a.prototype.j=function(){this.a.hasAttribute("data-tagr")||this.a.setAttribute("data-tagr",n(this.a));return this.a.getAttribute("data-tagr")};
a.prototype.get=function(a){var b;return this.a[(b=w[a])!=h?b:a]};a.prototype.set=t(function(a,b){var d;this.m("change:"+a,b);this.a[(d=w[a])!=h?d:a]=b;return this});a.prototype.remove=function(a){this.a.removeAttribute(a);return this};a.prototype.splice=function(){var a,b,d,f,i,j,k,l;d=arguments[0];b=arguments[1];a=3<=arguments.length?m.call(arguments,2):[];for(f=i=0;0<=b?i<b:i>b;f=0<=b?++i:--i)this.a.removeChild(this.a.childNodes[d]),"object"===typeof this[d+f]&&this[d+f].i();j=this.a.childNodes[d];
f=k=0;for(l=a.length;k<l;f=++k){i=a[f];"object"===typeof i?(i.constructor===Array&&(i=a[f]=g.parse(i)),f=i.a):f=document.createTextNode(i);if(f.parentNode)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(f,j);"object"===typeof i&&i.h(this)}return G.apply(h,[this,d,b].concat(m.call(a)))};a.prototype.append=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[this.length,0].concat(m.call(a)));return this};a.prototype.remove=function(a){this.splice(a,
1);return this};return a}(v);B=["forEach","slice","map","indexOf"];s=function(b){r.prototype[b]=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];return Array.prototype[b].apply(this,a)}};u=0;for(H=B.length;u<H;u++)q=B[u],s(q);g.r=function(){var b,a;a={};b=function(b){var e;b==h&&(b="all");if(a[b]!=h)return a[b];e=new y(b);return a[b]=e.sheet||e.styleSheet};return function(a){function e(a,c){var e=this;this.l=a;this.n=c;this.style=new p(this,{set:t(z(A(function(a,c){var d,f;d="[data-tagr='"+
e.l.j()+"'] "+e.n;f=b();f.insertRule(""+d+" { "+a+": "+c+" }",f.cssRules.length);return e})))})}C(e,a);e.name="TagrQuery";return e}(v)}();g.view={F:function(b,a){var c,e,d,f;c=b.a.getBoundingClientRect();if(a!=h)for(e in f=a.a.getBoundingClientRect(),f)d=f[e],c[e]-=d;return c},G:function(b,a){return E(b.a,a)}}}).call(this);
