/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var h=void 0,o=null;
(function(){function D(a,b){function c(){this.constructor=a}for(var d in b)J.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.u=b.prototype}var p,q,v,w,E,x,y,r,s,F,l,z,t,G,i,H,A,u,I,B,m=[].slice,J={}.hasOwnProperty;v=function(){function a(){}a.name="EventEmitter";a.prototype.h=function(b){return this.hasOwnProperty.call(this.b!=o?this.b:this.b={},b)?this.b[b]:this.b[b]=[]};a.prototype.o=function(){var b,c,d,a,f,g;d=arguments[0];b=2<=arguments.length?m.call(arguments,1):[];g=this.h(d);
a=0;for(f=g.length;a<f;a++)c=g[a],c.apply(this,b);this.h(d)};return a}();p=function(){function a(b,c){this.g=b;this.e=c!=o?c:{};this.hash={};this.length=0}a.name="ArrayHash";a.prototype.get=function(b){var c;return((c=this.e)!=o?c.get:h)!=o?this.e.get(b):this.hash["@"+b]};a.prototype.set=t(z(A(function(b,c){var d;Object.prototype.hasOwnProperty.call(this.hash,"@"+b)||(this[this.length++]=b);(d=this.e)!=o&&"function"===typeof d.set&&d.set(b,c);this.hash["@"+b]=c;return this.g})));a.prototype.remove=
function(b){var c,d,a,f,g;if(!Object.prototype.hasOwnProperty.call(this.hash,"@"+b))return this.g;c=a=0;for(f=this.length;a<f;c=++a)if(d=this[c],d===b){d=a=c;for(f=this.length-1;c<=f?a<f:a>f;d=c<=f?++a:--a)this[d]=this[d+1];break}this.length--;(g=this.e)!=o&&"function"===typeof g.remove&&g.remove(b);delete this.hash["@"+b];return this.g};return a}();t=function(a){return function(b,c){var d,e;if(!(1<arguments.length)){for(d in b)e=b[d],e=a.call(this,d,e);return e}return a.call(this,b,c)}};z=function(a){return function(b,
c){var d,e,f;if("object"===typeof b&&(b!=o?b.length:h)!=o){e=0;for(f=b.length;e<f;e++)d=b[e],d=a.call(this,d,c);return d}return a.call(this,b,c)}};A=function(a){return function(b,c){var d,e,f;if("object"===typeof c&&(c!=o?c.length:h)!=o){e=0;for(f=c.length;e<f;e++)d=c[e],d=a.call(this,b,d);return d}return a.call(this,b,c)}};H=function(){return name.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})};y=function(a){var b;a==o&&(a="all");b=document.createElement("style");b.type=
"text/css";b.media=a;return document.getElementsByTagName("head")[0].appendChild(b)};x=/(?:^|\s+)([^.#\[\]:\s]*)(\S+)\s*$/;E=/([:#.]+)([^:#.]+)/g;G=function(a){var b,c,d,e;if(b=a.match(x)){a={i:b[1]||"div",d:[],id:o};e=b[2].match(E);c=0;for(d=e.length;c<d;c++)switch(b=e[c],b[0]){case "#":a.id=b.substr(1);break;case ".":a.d.push(b.substr(1))}return a}};w={"for":"htmlFor",w:"accessKey",B:"codeBase",F:"frameBorder",G:"frameSpacing",M:"noWrap",L:"maxLength","class":"className",N:"readOnly",K:"longDesc",
Q:"tabIndex",P:"rowSpan",C:"colSpan",enctype:"encType",J:"isMap",S:"useMap",z:"cellPadding",A:"cellSpacing"};s=function(){var a,b,c,d;d=/^loade|c/.test(document.readyState);c=[];a=function(b){var a;d=!0;for(a=[];b=c.shift();)a.push(b());return a};if(document.documentElement.doScroll)return document.attachEvent("onreadystatechange",b=function(){if(/^c/.test(document.readyState))return document.detachEvent("onreadystatechange",b),a()}),function(b){return self!==top?d?b():c.push(b):function(){try{testEl.doScroll("left")}catch(c){return setTimeout(function(){return ready(b)},
50)}return b()}()};if(document.addEventListener!=o)return document.addEventListener("DOMContentLoaded",b=function(){document.removeEventListener("DOMContentLoaded",b,!1);return a()},!1),function(b){return d?b():c.push(b)}}();F=function(a,b){var c,d,e;if(window.getComputedStyle)return c=a.ownerDocument.defaultView.getComputedStyle(a,o),c=c!=o?c.getPropertyValue(b):h,"opacity"===b&&""===c?"1":c;if(a.currentStyle)return c=(d=a.currentStyle[b])!=o?d:a.currentStyle[H()],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&
(e=[a.style.left,a.runtimeStyle.left],d=e[0],e=e[1],a.runtimeStyle.left=a.currentStyle.left,a.style.left="font-size"===b?"1em":c||0,c=a.style.pixelLeft+"px",d=[d,e],a.style.left=d[0],a.runtimeStyle.left=d[1]),c};(function(){var a;if(document.querySelector!=o)return function(b,c){return b.querySelectorAll(c)};if(document.documentElement.currentStyle!=o)return a=new y,function(b,c){var d,e;d=(e=c.match(x))!=o?e[1]:h;a.addRule(c,"foo:bar");var f,g,j;g=d?b.R(d):b.all;j=[];e=0;for(f=g.length;e<f;e++)d=
g[e],"bar"===d.currentStyle.D&&j.push(d);a.removeRule(0);return j}})();l=function(){var a;a=0;return function(b){var c;return(c=b.q)!=o?c:b.q=a++}}();q=function(){function a(){this.f={}}a.name="DomMap";a.prototype.set=function(b,c){return this.f[l(b)]=c};a.prototype.get=function(b){return this.f[l(b)]};a.prototype.remove=function(b){return delete this.f[l(b)]};return a}();i=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];return i.create.apply(i,a)};i.r=["data-tagr"];i.create=function(a,
b){var c,d;b==o&&(b={});d=G(a);c=document.createElement(d.i);c.className=d.d.join(" ");c.id=d.id;return(new r(c)).set(b)};i.parse=function(a){var b,c,d,e,f;if("string"===typeof a)return a;e=a[0];d=a[1];c=3<=a.length?m.call(a,2):[];return(f=i.create(e,d)).append.apply(f,function(){var a,d,e;e=[];a=0;for(d=c.length;a<d;a++)b=c[a],e.push(i.parse(b));return e}())};i.O=s;i.c=new q;i.m=function(a){var b=!0,c;b==o&&(b=!1);if(1!==a.nodeType)throw Error("Cannot create Tagr context of non-element");if((c=i.c.get(a))==
o){if(!b)throw Error("No Tagr wrapper exists for this element.");i.c.set(a,c=new r(a))}return c};i.getContext=function(a){return i.m(a)};i.T=function(a,b){var c;a==o&&(a="div");b==o&&(b={});document.write("<"+a+"></"+a+">");c=document.getElementsByTagName(a);c=i.getContext(c[c.length-1]).set(b);console.log(c);return c};i.s=r=function(a){function b(a,d){var e,f,g,j,i,k=this;this.a=a;this.parent=d;this.i=this.a.nodeName.toLowerCase();this.d=new p(this,{set:function(b){var a;return k.a.className=""+
function(){var c,d,e,f;e=(c=this.a.className.match(/\S+/g))!=o?c:[];f=[];c=0;for(d=e.length;c<d;c++)a=e[c],a!==b&&f.push(a);return f}.call(k).join("")+" "+b},get:function(b){return!!k.a.className.match(RegExp("\\b"+b+"\\b"))},remove:function(b){var a;return k.a.className=function(){var c,d,e,f;e=(c=this.a.className.match(/\S+/g))!=o?c:[];f=[];c=0;for(d=e.length;c<d;c++)a=e[c],a!==b&&f.push(a);return f}.call(k).join("")}});j=this.a.className.match(/\S+/g)||[];f=0;for(g=j.length;f<g;f++)e=j[f],console.log(e),
this.d.set(e);this.style=new p(this,{set:function(c,b){return k.a.style[c]=b},get:function(c){return k.a.style[c]},remove:function(c){return delete k.a.style[c]}});this.length=this.a.childNodes.length;i=this.a.childNodes;f=g=0;for(j=i.length;g<j;f=++g)e=i[f],this[f]=1===e.nodeType?new b(e,this):e.v}D(b,a);b.name="Tagr";b.prototype.j=function(c){this.parent=c;i.c.set(this.a,this)};b.prototype.k=function(){delete this.parent;i.c.remove(this.a)};b.prototype.l=function(){this.a.hasAttribute("data-tagr")||
this.a.setAttribute("data-tagr",l(this.a));return this.a.getAttribute("data-tagr")};b.prototype.get=function(c){var b;return this.a[(b=w[c])!=o?b:c]};b.prototype.set=t(function(c,b){var a;this.o("change:"+c,b);return this.a[(a=w[c])!=o?a:c]=b});b.prototype.remove=function(b){return this.a.removeAttribute(b)};b.prototype.splice=function(){var b,a,e,f,g,j,n,k,C,l;f=arguments[0];e=arguments[1];b=3<=arguments.length?m.call(arguments,2):[];if(0>f||isNaN(f))throw"Invalid index";if(e){j=[];for(g=n=0;0<=
e?n<e:n>e;g=0<=e?++n:--n)a=this[f+g],this.a.removeChild(this.a.childNodes[f]),"object"===typeof a&&a.k(),delete this[f+g],j.push(a);n=j}if(e>b.length){g=a=j=f+e;for(k=this.length;j<=k?a<k:a>k;g=j<=k?++a:--a)this[g-e]=this[g]}else if(b.length>e)for(g=a=j=this.length+b.length-1;j<=f?a<f:a>f;g=j<=f?++a:--a)this[g]=this[g-b.length];if(b.length){k=this.a.childNodes[f];g=C=0;for(l=b.length;C<l;g=++C){a=b[g];"object"===typeof a&&(a!=o?a.constructor:h)===Array?(a=i.parse(a),j=a.a):j="string"===typeof a?document.createTextNode(a):
a.a;if(j.parentNode)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(j,k);"object"===typeof a&&a.j(this);this[f+g]=a}}this.length+=-e+b.length;return n};b.prototype.append=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[this.length,0].concat(m.call(a)));return this};b.prototype.remove=function(a){this.splice(a,1);return this};return b}(v);B=["forEach","slice","map","indexOf"];s=function(a){r.prototype[a]=function(){var b;b=1<=
arguments.length?m.call(arguments,0):[];return Array.prototype[a].apply(this,b)}};u=0;for(I=B.length;u<I;u++)q=B[u],s(q);i.t=function(){var a,b;b={};a=function(a){var d;a==o&&(a="all");if(b[a]!=o)return b[a];d=new y(a);return b[a]=d.sheet||d.styleSheet};return function(b){function d(b,c){var d=this;this.n=b;this.p=c;this.style=new p(this,{set:t(z(A(function(b,c){var e,f;e="[data-tagr='"+d.n.l()+"'] "+d.p;f=a();f.insertRule(""+e+" { "+b+": "+c+" }",f.cssRules.length);return d})))})}D(d,b);d.name="TagrQuery";
return d}(v)}();i.view={H:function(a,b){var c,d,e,f;c=a.a.getBoundingClientRect();if(b!=o)for(d in f=b.a.getBoundingClientRect(),f)e=f[d],c[d]-=e;return c},I:function(a,b){return F(a.a,b)}}}).call(this);
