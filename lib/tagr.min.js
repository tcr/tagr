/*
 Tagr, Solid HTML manipulation for webapps. MIT Licensed.
*/
var e=null,f=!1;
if("undefined"===typeof g&&"undefined"===typeof module){var g=function(){};g.prototype.listeners=function(a){this.d=this.d||{};return hasOwnProperty(this.d,a)?this.d[a]:this.d[a]=[]};g.prototype.on=function(){return this.addListener.apply(this,arguments)};g.prototype.once=function(a,b){function c(){b.apply(this,arguments);return this.removeListener(a,c)}return this.r(a,c)};g.prototype.addListener=function(a,b){this.i(a).push(b)>this.p&&0!==this.p&&"undefined"!==typeof console&&console.warn("Possible EventEmitter memory leak detected. "+this.d[a].length+
" listeners added. Use emitter.setMaxListeners() to increase limit.");this.h("newListener",a,b);return this};g.prototype.removeListener=function(a,b){var c=this.i(a).indexOf(b);-1!==c&&this.i(a).splice(c,1);return this};g.prototype.removeAllListeners=function(a){var b,c,d=this.d||{};for(b in d)c=d[b],(a==e||a===b)&&c.splice(0,c.length);return this};g.prototype.emit=function(a){for(var b=0,c=this.i(a);b<c.length;b++)c[b].apply(this,slice(arguments,1));return 0<this.i(a).length};g.prototype._maxListeners=
10;g.prototype.setMaxListeners=function(a){this.p=a}}else g=require("events").A;var h;function j(a){return"[object Array]"===Object.prototype.toString.call(a)}function k(a){return"[object Object]"==Object.prototype.toString.call(a)}function l(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1}function m(a,b){function c(){this.constructor=a}c.prototype=b;a.prototype=new c}function p(a){return function(){a.apply(this,arguments);return this}}
function q(a){return function(b,c){if("object"===typeof b){for(var d in b)a.call(this,d,b[d]);return this}return a.call(this,b,c)}}function r(a){return function(b,c){if(j(b)){var d=this;b.forEach(function(b){a.call(d,b,c)});return this}return a.call(this,b,c)}}function s(a){return function(b,c){if(j(c)){var d=this;c.forEach(function(c){a.call(d,b,c)});return this}return a.call(this,b,c)}}
function t(a){this.q=a;var b=this;a.r("change:class",function(a){b.splice(0,b.length);b.push.apply(b,a.length?a.replace(/^\s+|\s+$/g,"").split(/\s+/):[])})}function u(a){this.g=a;this.b={};this.l={};this.c={};this.classList=new t(this)}
function v(a){a.target=a.target?3===a.target.nodeType?a.target.parentNode:a.target:a.srcElement;a.relatedTarget=a.relatedTarget||("mouseover"==a.type?a.fromElement:a.toElement);a.offsetX=a.offsetX||a.layerX;a.offsetY=a.offsetY||a.layerY;a.keyCode=a.keyCode||a.which;a.metaKey=a.metaKey===e?a.ctrlKey:a.metaKey;a.preventDefault=a.preventDefault||function(){this.returnValue=f};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=!0};return a}
var w,y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};w=function(a){return a.replace(/[&<>'"]/g,function(a){return y[a]})};var z="area base br col command embed hr img input keygen link meta param source track wbr".split(" "),A=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/,B=/([:#.]+)([^:#.]+)/g;extend(t,[]);t.prototype.item=function(a){return this[a]||e};t.prototype.contains=function(a){return-1!==l(this,String(a))};t.prototype.add=function(a){this.contains(a)||this.q.set("class",this.concat([a]).join(" "))};
t.prototype.remove=function(a){for(var b=[],c=0;c<this.length;c++)this[c]!=String(a)&&b.push(this[c]);this.q.set("class",b.join(" "))};t.prototype.toggle=function(a){this.contains(String(a))?this.add(a):this.remove(a)};t.prototype.toString=function(){return this.join(" ")};m(u,[]);var C=u.prototype,D=g.prototype,E;for(E in D)Object.prototype.hasOwnProperty.call(D,E)&&(C[E]=D[E]);u.prototype.get=function(a){return this.b[a]};u.prototype.set=p(q(r(s(function(a,b){this.h("change:"+a,b);this.b[a]=b}))));
u.prototype.remove=function(a){this.h("change:"+a);return delete this.b[a]};u.prototype.call=function(a){return this_props[a].apply(this,Array.prototype.slice.call(arguments,1))};u.prototype.properties=function(){return clone(this.b)};u.prototype.persist=function(a){this.c[a]=f};u.prototype.stopPersisting=function(a){this.c[a]=!0};u.prototype.insert=p(function(a,b){0>a&&(a+=this.length+1);this.splice.apply(this,[a,0].concat(b))});
u.prototype.remove=p(function(a,b){0>a&&(a+=this.length+1);this.splice(a,b==e?1:b)});u.prototype.children=p(function(a){this.splice.apply(this,[0,this.length].concat(a))});u.prototype.insertSelf=p(function(a,b){a.insert(b,this)});u.prototype.removeSelf=p(function(){this.parent.remove(this.index())});u.prototype.index=function(){return this.parent.indexOf(this)};
u.prototype.spliceText=function(a,b,c,d){if("string"!==typeof this[a])throw Error("Only a string can be spliced.");this[a]=this[a].substr(0,b)+(d||"")+this[a].substr(b+c)};u.prototype.splitText=function(a,b){if("string"!==typeof this[a])throw Error("Cannot split non-text node.");Array.prototype.splice.call(this,a,1,this[a].substr(0,b),this[a].substr(b))};u.prototype.style=p(q(r(s(function(a,b){this.addRule(a,b)}))));u.prototype.rules=function(){return JSON.parse(JSON.stringify(this.l))};
u.prototype.addRule=function(a,b){this.l[a]=b};u.prototype.removeRule=function(a){return delete this.l[a]};u.prototype.query=function(a){return new F.TagrQuery(this,a)};u.prototype.findAll=function(a){return this.query(a).findAll()};u.prototype.find=function(a){return this.query(a).find()};u.prototype.toJSON=function(){return[this.g,this.w()].concat(this.map(function(a){return"string"===typeof a?a:a.toJSON()}))};function G(){}
var H={"for":"htmlFor",accesskey:"accessKey",codebase:"codeBase",frameborder:"frameBorder",framespacing:"frameSpacing",nowrap:"noWrap",maxlength:"maxLength","class":"className",readonly:"readOnly",longdesc:"longDesc",tabindex:"tabIndex",rowspan:"rowSpan",colspan:"colSpan",enctype:"encType",ismap:"isMap",usemap:"useMap",cellpadding:"cellPadding",cellspacing:"cellSpacing"},I,J=1;I=function(a){return a.z||(a.z=J++)};function K(a){this.a=a;u.call(this,a.tagName.toLowerCase())}m(K,u.prototype);
K.prototype.s=function(a){this.parent=a;F.B.set(this.a,this)};K.prototype.m="";K.prototype.o=function(){this.m||(this.a.className+=" "+(this.m="tagr-"+I(this.a)));return this.m};K.prototype.get=function(a){return(H[a]||a)in this.a?this.a[H[a]||a]:this.b[a]};K.prototype.set=p(q(r(s(function(a,b){this.h("change:"+a,b);(H[a]||a)in this.a?this.a[H[a]||a]=b:this.b[a]=b}))));K.prototype.remove=function(a){this.h("change:"+a);return(H[a]||a)in this.a?delete this.a[H[a]||a]:delete this.b[a]};
K.prototype.call=function(a){return(H[a]||a)in this.a?this.a[H[a]||a].apply(this.a,Array.prototype.slice.call(arguments,1)):this.b[a].apply(this,Array.prototype.slice.call(arguments,1))};
K.prototype.properties=function(){var a={},b;for(b in this.b)Object.prototype.hasOwnProperty.call(this.b,b)&&!this.c[b]&&(a[b]=this.b);for(var c=0;c<this.a.attributes.length;c++){var d=this.a.attributes[c];this.c[d.name]!==f&&(a[d.name]=this.a[H[d.name]||d.name])}for(b in this.c)Object.prototype.hasOwnProperty.call(this.c,b)&&(!Object.prototype.hasOwnProperty.call(this.b,b)&&this.c[b]==f)&&(a[b]=this.a[H[b]||b]);return a};
K.prototype.addListener=function(a,b){var c=this;this.a.addEventListener?this.a.addEventListener(a,function(b){return c.emit(a,v(b))},f):this.a.attachEvent&&this.a.attachEvent("on"+a,function(){return c.emit(a,v(window.event))});return g.prototype.addListener.call(this,a,b)};
K.prototype.splice=function(a,b){for(var c=this.a,d=0;d<b;d++)c.removeChild(c.childNodes[a]);for(var i=c.childNodes[a],d=0;d<arguments.length-2;d++){var o=arguments[d+2],x;x="string"==typeof arguments[d+2]?document.createTextNode(o):o.a;if(x.parentNode&&1==x.parentNode.nodeType)throw Error("Must remove element before appending elsewhere.");c.insertBefore(x,i);"string"!=typeof o&&o.s(this)}return Array.prototype.slice.apply(this,arguments)};
u.prototype.push=function(){return this.u.apply(this,[this.length].concat(Array.prototype.slice.call(arguments,void 0)))};u.prototype.pop=function(){return this.remove(this.length-1)};u.prototype.unshift=function(){return this.u.apply(this,[0].concat(arguments))};u.prototype.shift=function(){return this.remove(0)};u.prototype.sort=function(){};u.prototype.reverse=function(){};
u.prototype.spliceText=function(a,b,c,d){this.a.childNodes[a].replaceData(b,c,d||"");return u.prototype.spliceText.apply(this,arguments)};u.prototype.splitText=function(a,b){this.a.childNodes[a].splitText(b);return u.prototype.splitText.apply(this,arguments)};
K.prototype.toHTML=function(){var a=["<"+this.g],b=this.w(),c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(" "+w(c)+'="'+w(String(b[c]))+'"');a.push(">");if(-1==l(z,this.g)){for(b=0;b<this.length;b++)a.push("string"==typeof this[b]?w(this[b]):this[b].G());a.push("</"+this.g+">")}return a.join("")};function L(a,b){this.C=this.e=a;this.j=b}var M={};extend(L,g.prototype);
L.prototype.style=p(q(r(s(function(a,b){var c;c=c||"all";M[c]==e&&(M[c]=new Stylesheet(c));c=M[c];c.insertRule!=e?c.insertRule("."+this.e.o()+" "+this.j+" { "+a+": "+b+" }",c.cssRules.length):c.addRule("."+this.e.o()+" "+this.j,""+a+": "+b);return this}))));
L.prototype.addListener=function(a,b){var c=this;this.e.r(a,function(a){var i,o;i=findBySelector(c.e.a,c.j);n=a.target||a.srcElement;for(o=[];n!==c.e.a&&n;)0<=l(i,n)&&b.call(F.k(n),a),o.push(n=n.parentNode);return o},f);return g.prototype.addListener.call(this,a,b)};L.prototype.find=function(){return this.F()[0]};L.prototype.findAll=function(){var a,b,c,d,i;d=findBySelector(this.e.a,this.j);i=[];b=0;for(c=d.length;b<c;b++)a=d[b],i.push(F.k(a));return i};
var G=L,N=F.ElementAnchor=function(a,b){this.v=a;this.t=b},O=F.TextAnchor=function(a,b,c){this.v=a;this.D=b;this.t=c};convertAnchor=function(a){var b,c;c=a[0];a=a[1];if(1===c.nodeType){if(c=F.k(c))return new N(c,a)}else if(F.k(c.parentNode)){b=0;for(n=c;n.previousSibling;)n=n.previousSibling,b++;return new O(el,b,a)}};
u.prototype.useWhitespace=function(a){a==e&&(a=!0);return a?this.style({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style(["white-space","word-wrap"],"")};u.prototype.setSelectable=function(a){a==e&&(a=!0);return this.style("-webkit-touch-callout -webkit-user-select -khtml-user-select -moz-user-select -ms-user-select user-select".split(" "),a?"":"none")};
var F={TagrElement:u,TagrQuery:G,create:function(a){var b;var c;if(c=(a||"").match(A)){b={g:c[1]||"div",f:{}};c=c[2].match(B)||[];for(var d=0,i=c.length;d<i;d++)switch(c[d].charAt(0)){case "#":b.f.id=c[d].substr(1);break;case ".":b.f.n||(b.f.n=""),b.f.n+=" "+c[d].substr(1)}}else b=void 0;c=k(arguments[1])?arguments[1]:{};d=Array.prototype.slice.call(arguments,k(arguments[1])?2:1);return(new u(b.g)).set(c).set(b.f).children(d)},parse:function(a){if("string"!=typeof a){for(var b=k(a[1])?a[1]:{},c=a.slice(k(a[1])?
2:1),d=0;d<c.length;d++)j(c[d])&&(c[d]=F.parse(c[d]));return F.create(a[0],b).children(c)}}};h=F;console.log(h.create("div","Hey mom!",h.create("b","Bold text.")));
