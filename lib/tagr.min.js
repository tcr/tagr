/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var h=void 0,o=null;
(function(){function F(b,a){function c(){this.constructor=b}for(var e in a)N.call(a,e)&&(b[e]=a[e]);c.prototype=a.prototype;b.prototype=new c;b.n=a.prototype}var u,v,G,x,y,H,z,A,p,I,q,r,B,J,s,C,w,n,K,L,g,t,D,M,E,l=[].slice,N={}.hasOwnProperty,O=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};x=function(){function b(){}b.name="EventEmitter";b.prototype.listeners=function(a){return this.hasOwnProperty.call(this.b!=o?this.b:this.b={},a)?this.b[a]:
this.b[a]=[]};b.prototype.on=function(){return this.addListener.apply(this,1<=arguments.length?l.call(arguments,0):[])};b.prototype.once=function(a,c){var b;return this.on(a,b=function(){var d;d=1<=arguments.length?l.call(arguments,0):[];c.apply(this,d);return this.removeListener(a,b)})};b.prototype.addListener=function(a,c){this.listeners(a).push(c)>this.f&&0!==this.f&&"undefined"!==typeof console&&console!==o&&console.warn("Possible EventEmitter memory leak detected. "+this.b[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");
this.emit("newListener",a,c);return this};b.prototype.removeListener=function(a,c){var b;-1!==(b=this.listeners(a).indexOf(c))&&this.listeners(a).splice(b,1);return this};b.prototype.removeAllListeners=function(a){var c,b,d;d=this.b||{};for(c in d)b=d[c],(a==o||a===c)&&b.splice(0,b.length);return this};b.prototype.emit=function(){var a,c,b,d,f,i;b=arguments[0];a=2<=arguments.length?l.call(arguments,1):[];i=this.listeners(b);d=0;for(f=i.length;d<f;d++)c=i[d],c.apply(this,a);return 0<this.listeners(b).length};
b.prototype.f=10;b.prototype.setMaxListeners=function(a){this.f=a};return b}();w=function(b){return function(a,c){var e,d;if(!(1<arguments.length||"object"!==typeof a)){for(e in a)d=a[e],b.call(this,e,d);return this}return b.call(this,a,c)}};C=function(b){return function(a,c){var e,d,f;if("object"===typeof a&&(a!=o?a.length:h)!=o){d=0;for(f=a.length;d<f;d++)e=a[d],b.call(this,e,c);return this}return b.call(this,a,c)}};D=function(b){return function(a,c){var e,d,f;if("object"===typeof c&&(c!=o?c.length:
h)!=o){d=0;for(f=c.length;d<f;d++)e=c[d],b.call(this,a,e);return this}return b.call(this,a,c)}};u=function(){function b(a,c){var b,d,f;c==o&&(c={});d={};b=this;b.length=0;f=function(c,a){return function(){return a.apply(c,arguments)}};this.get=f(a,function(a){return(c!=o?c.get:h)!=o?c.get(a):d["@"+a]});this.set=f(a,w(C(D(function(a,f){Object.prototype.hasOwnProperty.call(d,"@"+a)||(b[b.length++]=a);c!=o&&"function"===typeof c.set&&c.set(a,f);d["@"+a]=f;return this}))));this.remove=f(a,function(a){var f,
j,k,g;if(Object.prototype.hasOwnProperty.call(d,"@"+a)){f=k=0;for(g=this.length;k<g;f=++k)if(j=this[f],j===a){j=k=f;for(g=b.length-1;f<=g?k<g:k>g;j=f<=g?++k:--k)b[j]=b[j+1];break}b.length--;c!=o&&"function"===typeof c.remove&&c.remove(a);delete d["@"+a]}return this})}b.name="ArrayHash";return b}();t=function(b){return b.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})};L=function(){var b,a,c,e,d,f,i,m,j;f=arguments[0];e=arguments[1];c=arguments[2];b=4<=arguments.length?l.call(arguments,
3):[];if(0>e||isNaN(e))throw"Invalid index";if(c){i=[];for(d=a=0;0<=c?a<c:a>c;d=0<=c?++a:--a)i.push(f[e+d]),delete f[e+d]}if(c>b.length){d=a=m=e+c;for(j=f.length;m<=j?a<j:a>j;d=m<=j?++a:--a)f[d-c]=f[d]}else if(b.length>c)for(d=a=m=f.length+b.length-1;m<=e?a<e:a>e;d=m<=e?++a:--a)f[d]=f[d-b.length];if(b.length){d=m=0;for(j=b.length;m<j;d=++m)a=b[d],f[e+d]=a}f.length+=-c+b.length;return i};this.Stylesheet=A=function(b){var a;b==o&&(b="all");a=document.createElement("style");a.type="text/css";a.media=
b;return document.getElementsByTagName("head")[0].appendChild(a)};this.Script=function(){var b;b=document.createElement("script");b.src="about:blank";return document.getElementsByTagName("head")[0].appendChild(b)};y={"for":"htmlFor",w:"accessKey",D:"codeBase",H:"frameBorder",I:"frameSpacing",R:"noWrap",Q:"maxLength","class":"className",S:"readOnly",P:"longDesc",V:"tabIndex",T:"rowSpan",F:"colSpan",enctype:"encType",O:"isMap",X:"useMap",A:"cellPadding",B:"cellSpacing"};q=function(){var b,a,c,e;e=/^loade|c/.test(document.readyState);
c=[];b=function(a){var b;e=!0;for(b=[];a=c.shift();)b.push(a());return b};if(document.documentElement.doScroll)return document.attachEvent("onreadystatechange",a=function(){if(/^c/.test(document.readyState))return document.detachEvent("onreadystatechange",a),b()}),function(a){return self!==top?e?a():c.push(a):function(){try{testEl.doScroll("left")}catch(c){return setTimeout(function(){return ready(a)},50)}return a()}()};if(document.addEventListener!=o)return document.addEventListener("DOMContentLoaded",
a=function(){document.removeEventListener("DOMContentLoaded",a,!1);return b()},!1),function(a){return e?a():c.push(a)}}();J=function(b,a){var c,e,d;if(window.getComputedStyle)return c=b.ownerDocument.defaultView.getComputedStyle(b,o),c=c!=o?c.getPropertyValue(a):h,"opacity"===a&&""===c?"1":c;if(b.currentStyle)return c=(e=b.currentStyle[a])!=o?e:b.currentStyle[t(a)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(d=[b.style.left,b.runtimeStyle.left],e=d[0],d=d[1],b.runtimeStyle.left=b.currentStyle.left,
b.style.left="font-size"===a?"1em":c||0,c=b.style.pixelLeft+"px",e=[e,d],b.style.left=e[0],b.runtimeStyle.left=e[1]),c};B=function(){var b;b=function(){var a;if(document.querySelector!=o)return function(a,b){return a.querySelectorAll(b)};if(document.documentElement.currentStyle!=o)return a=new A,function(c,b){var d,f;d=(f=b.match(z))!=o?f[1]:h;a.addRule(b,"foo:bar");var i,m,j;m=d?c.W(d):c.all;j=[];f=0;for(i=m.length;f<i;f++)d=m[f],"bar"===d.currentStyle.G&&j.push(d);a.removeRule(0);return j}}();return function(a,
c){return"undefined"!==typeof Sizzle?Sizzle(c,a):b(a,c)}}();s=function(){var b;b=0;return function(a){var c;return(c=a.t)!=o?c:a.t=b++}}();v=function(){function b(){this.h={}}b.name="DomMap";b.prototype.set=function(a,c){return this.h[s(a)]=c};b.prototype.get=function(a){return this.h[s(a)]};b.prototype.remove=function(a){return delete this.h[s(a)]};return b}();z=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/;H=/([:#.]+)([^:#.]+)/g;K=function(b){var a,c,e,d;if(a=b.match(z)){b={o:a[1]||"div",i:[],id:o};d=a[2].match(H)||
[];c=0;for(e=d.length;c<e;c++)switch(a=d[c],a[0]){case "#":b.id=a.substr(1);break;case ".":b.i.push(a.substr(1))}return b}};this.tagr=g=function(b,a){var c,e;a==o&&(a={});e=K(b||"");c=document.createElement(e.o);e.i.length&&(c.className=e.i.join(" "));e.id&&(c.id=e.id);return(new p(c)).set(a)};g.u=["data-tagr"];g.parse=function(b){var a,c,e,d,f;if("string"===typeof b)return b;d=b[0];e=b[1];c=3<=b.length?l.call(b,2):[];return(f=g(d,e)).append.apply(f,function(){var b,d,e;e=[];b=0;for(d=c.length;b<
d;b++)a=c[b],e.push(g.parse(a));return e}())};g.ready=q;g.e=new v;g.c=function(b,a){var c;a==o&&(a=!1);if(1!==b.nodeType)throw Error("Cannot create Tagr context of non-element");if((c=g.e.get(b))==o){if(!a)throw Error("No Tagr wrapper exists for this element.");g.e.set(b,c=new p(b))}return c};g.getContext=function(b){return g.c(b,!0)};g.writeContext=function(b,a){var c;b==o&&(b="div");a==o&&(a={});document.write("<"+b+"></"+b+">");c=document.getElementsByTagName(b);return g.getContext(c[c.length-
1]).set(a)};g.TagrElement=p=function(b){function a(b,e){var d,f,i,g,j,k=this;this.a=b;this.parent=e;this.tag=this.a.nodeName.toLowerCase();this.classes=new u(this,{set:function(a,b){var c;b==o&&(b=!0);return k.a.className=""+function(){var b,d,e,f;e=this.classes;f=[];b=0;for(d=e.length;b<d;b++)c=e[b],c!==a&&f.push(c);return f}.call(k).join("")+" "+(b?a:"")+" "+k.g},get:function(a){return!!k.a.className.match(RegExp("\\b"+a+"\\b"))},remove:function(a){var b;return k.a.className=function(){var c,d,
e,f;e=this.classes;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],b!==a&&f.push(b);return f}.call(k).join("")}});g=this.a.className.match(/\S+/g)||[];f=0;for(i=g.length;f<i;f++)d=g[f],this.classes.set(d);this.style=new u(this,{set:function(a,b){return k.a.style[t(a)]=b},get:function(a){return k.a.style[t(a)]},remove:function(a){return delete k.a.style[t(a)]}});this.length=this.a.childNodes.length;j=this.a.childNodes;f=i=0;for(g=j.length;i<g;f=++i)d=j[f],this[f]=1===d.nodeType?new a(d,this):d.v}F(a,b);a.name=
"TagrElement";a.prototype.p=function(a){this.parent=a;g.e.set(this.a,this)};a.prototype.q=function(){delete this.parent;g.e.remove(this.a)};a.prototype.r=function(){this.g==o&&(this.a.className+=" "+(this.g="tagr-"+s(this.a)));return this.g};a.prototype.get=function(a){var b;return this.a[(b=y[a])!=o?b:a]};a.prototype.set=w(function(a,b){var d;this.emit("change:"+a,b);this.a[(d=y[a])!=o?d:a]=b;return this});a.prototype.remove=function(a){this.a.removeAttribute(a);return this};a.prototype.addListener=
function(b,e){var d=this;this.a.addEventListener?this.a.addEventListener(b,function(a){return d.emit(b,a)},!1):this.a.attachEvent&&this.a.attachEvent("on"+b(function(){return d.emit(b,window.event)}));return a.n.addListener.call(this,b,e)};a.prototype.splice=function(){var a,b,d,f,i,m,j,k;d=arguments[0];b=arguments[1];a=3<=arguments.length?l.call(arguments,2):[];for(f=i=0;0<=b?i<b:i>b;f=0<=b?++i:--i)this.a.removeChild(this.a.childNodes[d]),"object"===typeof this[d+f]&&this[d+f].q();m=this.a.childNodes[d];
f=j=0;for(k=a.length;j<k;f=++j){i=a[f];"object"===typeof i?(i.constructor===Array&&(i=a[f]=g.parse(i)),f=i.a):f=document.createTextNode(i);if(f.parentNode)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(f,m);"object"===typeof i&&i.p(this)}return L.apply(o,[this,d,b].concat(l.call(a)))};a.prototype.append=function(){var a;a=1<=arguments.length?l.call(arguments,0):[];this.splice.apply(this,[this.length,0].concat(l.call(a)));return this};a.prototype.prepend=function(){var a;
a=1<=arguments.length?l.call(arguments,0):[];this.splice.apply(this,[0,0].concat(l.call(a)));return this};a.prototype.remove=function(a){this.splice(a,1);return this};a.prototype.insert=function(){var a,b;b=arguments[0];a=2<=arguments.length?l.call(arguments,1):[];this.splice.apply(this,[b,0].concat(l.call(a)));return this};a.prototype.empty=function(){this.splice(0,this.length);return this};a.prototype.appendSelf=function(a){a.append(this);return this};a.prototype.prependSelf=function(a){a.prepend(this);
return this};a.prototype.removeSelf=function(){this.parent.remove(this.index());return this};a.prototype.insertSelf=function(a,b){a.insert(b,this);return this};a.prototype.index=function(){return this.parent.indexOf(this)};a.prototype.select=function(a){return new g.TagrQuery(this,a)};a.prototype.find=function(a){return this.select(a).find()};a.prototype.toJSON=function(){var a;return[this.o,this.z].concat(l.call(function(){var b,d,f;f=[];b=0;for(d=this.length;b<d;b++)a=this[b],f.push("string"===
typeof a?a:a.toJSON());return f}.call(this)))};return a}(x);E=["forEach","slice","map","indexOf"];v=function(b){p.prototype[b]=function(){var a;a=1<=arguments.length?l.call(arguments,0):[];return Array.prototype[b].apply(this,a)}};q=0;for(M=E.length;q<M;q++)n=E[q],v(n);g.TagrQuery=function(){var b,a;a={};b=function(b){var e;b==o&&(b="all");if(a[b]!=o)return a[b];e=new A(b);return a[b]=e.sheet||e.styleSheet};return function(a){function e(a,c){var e=this;this.d=a;this.l=c;this.style=new u(this,{set:w(C(D(function(a,
c){var d;d=b();d.insertRule("."+e.d.r()+" "+e.l+" { "+a+": "+c+" }",d.cssRules.length);return e})))})}F(e,a);e.name="TagrQuery";e.prototype.addListener=function(a,b){var c=this;this.d.a.addEventListener(a,function(a){var d,e;d=B(c.d.a,c.l);n=a.target;for(e=[];n!==c.d.a&&n;)0<=O.call(d,n)&&b.call(g.c(n),a),e.push(n=n.parentNode);return e},!1);return e.n.addListener.call(this,a,b)};e.prototype.find=function(){var a,b,c,e,j;e=B(this.d.a,this.l);j=[];b=0;for(c=e.length;b<c;b++)a=e[b],j.push(g.c(a));return j};
return e}(x)}();G=function(){function b(a,b){this.k=a;this.j=b}b.name="ElementAnchor";b.prototype.m=function(){return[this.k.a,this.j]};return b}();I=function(){function b(a,b,e){this.k=a;this.s=b;this.j=e}b.name="TextAnchor";b.prototype.m=function(){return[this.k.a.childNodes[this.s],this.j]};return b}();r=function(b){var a,c;c=b[0];b=b[1];if(1===c.nodeType)return!(a=g.c(c))?h:new G(a,b);if(g.c(c.parentNode)){a=0;for(n=c;n.previousSibling;)n=n.previousSibling,a++;return new I(el,a,b)}};g.view={getBox:function(b,
a){var c,e,d,f;c=b.a.getBoundingClientRect();if(a!=o)for(e in f=a.a.getBoundingClientRect(),f)d=f[e],c[e]-=d;return c},getStyle:function(b,a){return J(b.a,a)},selection:{has:function(){return Selection.N(window)},getOrigin:function(){return r(Selection.L(window))},getFocus:function(){return r(Selection.K(window))},getStart:function(){return r(Selection.M(window))},getEnd:function(){return r(Selection.J(window))},set:function(b,a){return Selection.U.apply(Selection,[window].concat(l.call(b.m()),l.call(a.m())))},
remove:function(){return Selection.C(window)}}};p.prototype.useWhitespace=function(b){b==o&&(b=!0);return b?this.style.set({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style.set(["white-space","word-wrap"],"")};p.prototype.setSelectable=function(b){b==o&&(b=!0);return this.style.set("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),b?"":"none")}}).call(this);
