/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var h=null,r=!1,J=function(){function K(){if("undefined"!==typeof Sizzle)return function(a,c){return Sizzle(c,a)};if(o.querySelector!=h)return function(a,c){return a.querySelectorAll(c)};if(o.documentElement.currentStyle!=h){var a=new B;return function(b,c){var d,f;d=(f=c.match(C))!=h?f[1]:void 0;a.addRule(c,"foo:bar");var e,i,m;i=d?b.all.S(d):b.all;m=[];f=0;for(e=i.length;f<e;f++)d=i[f],"bar"===d.currentStyle.J&&m.push(d);a.removeRule(0);return m}}}function D(){var a,b,c,d,f,e,i,m,g;e=arguments[0];
d=arguments[1];c=arguments[2];a=4<=arguments.length?j(arguments,3):[];if(0>d||isNaN(d))throw"Invalid index";if(c){i=[];for(f=b=0;0<=c?b<c:b>c;f=0<=c?++b:--b)i.push(e[d+f]),delete e[d+f]}if(c>a.length){f=b=d+c;for(m=e.length;b<m;f=b+=1)e[f-c]=e[f]}else if(a.length>c)for(f=b=e.length+(a.length-c)-1;b>d;f=b+=-1)e[f]=e[f-(a.length-c)];if(a.length){f=m=0;for(g=a.length;m<g;f=++m)b=a[f],e[d+f]=b}e.length+=-c+a.length;return i}function j(a){return Array.prototype.slice.apply(a,Array.prototype.slice.call(arguments,
1))}function E(a){return a.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})}function v(a,b){function c(){this.constructor=a}c.prototype=b.prototype;a.prototype=new c}function w(a){return function(b,c){if("object"===typeof b){for(var d in b)a.call(this,d,b[d]);return this}return a.call(this,b,c)}}function x(a){return function(b,c){if("[object Array]"===Object.prototype.toString.call(b)){var d=this;b.forEach(function(b){a.call(d,b,c)});return this}return a.call(this,b,c)}}function y(a){return function(b,
c){if("[object Array]"===Object.prototype.toString.call(c)){var d=this;c.forEach(function(c){a.call(d,b,c)});return this}return a.call(this,b,c)}}function F(a){a.target=a.target?3===a.target.nodeType?a.target.parentNode:a.target:a.srcElement;a.relatedTarget=a.relatedTarget||("mouseover"==a.type?a.fromElement:a.toElement);a.offsetX=a.offsetX||a.layerX;a.offsetY=a.offsetY||a.layerY;a.keyCode=a.keyCode||a.which;a.metaKey=a.metaKey===h?a.ctrlKey:a.metaKey;a.preventDefault=a.preventDefault||function(){this.returnValue=
r};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=!0};return a}function G(a){var b;if(b=a.match(C)){a={c:b[1]||"div",n:[],id:h};b=b[2].match(L)||[];for(var c=0,d=b.length;c<d;c++)switch(b[c].charAt(0)){case "#":a.id=b[c].substr(1);break;case ".":a.n.push(b[c].substr(1))}return a}}function k(){}function t(){this.m={}}function B(a){var b=o.createElement("style");b.type="text/css";b.media=a||"all";o.getElementsByTagName("head")[0].appendChild(b);return b.sheet||b.styleSheet}function q(a){this.push.apply(this,
a.className?a.className.replace(/^\s+|\s+$/g,"").split(/\s+/):[]);this.s=function(){node.className=this.toString()}}var p,o,s=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};return function(b){return b.replace(/[&<>'"]/g,function(b){return a[b]})}}(),l={"for":"htmlFor",accesskey:"accessKey",codebase:"codeBase",frameborder:"frameBorder",framespacing:"frameSpacing",nowrap:"noWrap",maxlength:"maxLength","class":"className",readonly:"readOnly",longdesc:"longDesc",tabindex:"tabIndex",
rowspan:"rowSpan",colspan:"colSpan",enctype:"encType",ismap:"isMap",usemap:"useMap",cellpadding:"cellPadding",cellspacing:"cellSpacing"},M="area,base,br,col,command,embed,hr,img,input,keygen,link,meta,param,source,track,wbr".split(","),z=h,u=function(){var a;a=0;return function(b){var c;return(c=b.C)!=h?c:b.C=a++}}(),C=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/,L=/([:#.]+)([^:#.]+)/g;k.prototype.listeners=function(a){this.e=this.e?this.e:{};return Object.prototype.hasOwnProperty.call(this.e,a)?this.e[a]:
this.e[a]=[]};k.prototype.on=function(){return this.F.apply(this,j(arguments,0))};k.prototype.once=function(a,b){function c(){b.apply(this,j(arguments,0));return this.Q(a,c)}return this.B(a,c)};k.prototype.addListener=function(a,b){this.i(a).push(b)>this.k&&0!==this.k&&"undefined"!==typeof console&&console.warn("Possible EventEmitter memory leak detected. "+this.e[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");this.t("newListener",a,b);return this};k.prototype.removeListener=
function(a,b){var c=this.i(a).indexOf(b);-1!==c&&this.i(a).splice(c,1);return this};k.prototype.removeAllListeners=function(a){var b,c,d=this.e||{};for(b in d)c=d[b],(a==h||a===b)&&c.splice(0,c.length);return this};k.prototype.emit=function(){for(var a=arguments[0],b=0,c=this.i(a);b<c.length;b++)c[b].apply(this,j(arguments,1));return 0<this.i(a).length};k.prototype.k=10;k.prototype.setMaxListeners=function(a){this.k=a};t.prototype.set=function(a,b){return this.m[u(a)]=b};t.prototype.get=function(a){return this.m[u(a)]};
t.prototype.remove=function(a){return delete this.m[u(a)]};var g={create:function(a,b){if("string"!=typeof a)throw new Exception("Invalid tag or selector argument passed to tagr.create: "+a);var c=G(a||""),d=o.createElement(c.c);c.n.length&&(d.className=c.n.join(" "));c.id&&(d.id=c.id);c=new e(d);c.set(b||{});2<arguments.length&&c.push.apply(c,j(arguments,2));return c},D:["data-tagr"],parse:function(a){var b,c,d,f,e;if("string"===typeof a)return a;f=a[0];d=a[1];c=3<=a.length?j(a,2):[];return(e=g.create(f,
d)).push.apply(e,function(){var a,d,f;f=[];a=0;for(d=c.length;a<d;a++)b=c[a],f.push(g.parse(b));return f}())},ready:function(){function a(){var a;for(g=1;a=b.shift();)a()}var b=[],c,d=o,f=d.documentElement,e=f.doScroll,g=/^loade|^c/.test(d.readyState);d.addEventListener&&d.addEventListener("DOMContentLoaded",c=function(){d.removeEventListener("DOMContentLoaded",c,r);a()},r);e&&d.attachEvent("onreadystatechange",c=function(){/^c/.test(d.readyState)&&(d.detachEvent("onreadystatechange",c),a())});(ready=
e?function(a){self!=top?g?a():b.push(a):function(){try{f.doScroll("left")}catch(b){return setTimeout(function(){ready(a)},50)}a()}()}:function(a){g?a():b.push(a)})()}};g.h=new t;g.g=function(a,b){if(1!==a.nodeType)throw Error("Cannot create Tagr context of non-element");var c;if((c=g.h.get(a))==h){if(!b)throw Error("No Tagr wrapper exists for this element.");g.h.set(a,c=new e(a))}return c};g.getContext=function(a){return g.g(a,!0)};g.writeContext=function(a,b){var c=G(a||"");o.write("<"+c.c+"></"+
c.c+">");c=o.getElementsByTagName(c.c);c=g.getContext(c[c.length-1]);c.set(b||{});c.push.apply(c,j(arguments,2));return c};v(q,Array);q.prototype.item=function(a){return this[a]||h};q.prototype.contains=function(a){return-1!==Array.prototype.indexOf.call(this,""+a)};q.prototype.add=function(a){this.contains(a)||(this.push(""+a),this.s())};q.prototype.remove=function(a){var b=0;if(-1!==(b=Array.prototype.indexOf.call(this,""+a)))this.splice(b,1),this.s()};q.prototype.toggle=function(a){this.contains(""+
a)?this.add(a):this.remove(a)};q.prototype.toString=function(){return this.join(" ")};var A={input:["value"]},e=g.TagrElement=function(a,b){this.a=a;this.parent=b;this.tag=this.a.nodeName.toLowerCase();this.classList=new q(a);this.d={};this.b={};if(A[this.c])for(var c=0;c<A[this.c].length;c++)this.P(A[this.c][c]);var d=this.a.childNodes;this.length=d.length;for(c=0;c<this.length;c++){var f=d[c];this[c]=1===f.nodeType?new e(f,this):f.nodeValue}};v(e,k);e.prototype.u=function(a){this.parent=a;g.h.set(this.a,
this)};e.prototype.v=function(){delete this.parent;g.h.remove(this.a)};e.prototype.l="";e.prototype.r=function(){this.l||(this.a.className+=" "+(this.l="tagr-"+u(this.a)));return this.l};e.prototype.style=w(x(y(function(a,b){this.addRule(a,b);return this})));e.prototype.rules=function(){for(var a={},b=0;b<this.a.style.length;b++)a[this.a.style[b]]=this.a.style[this.a.style[b]];return a};e.prototype.addRule=function(a,b){try{this.a.style[E(a)]=b.replace(/^\s+|\s+$/g,"")}catch(c){}return this};e.prototype.removeRule=
function(a){return this.addRule(a,"")};e.prototype.get=function(a){return(l[a]||a)in this.a?this.a[l[a]||a]:this.d[a]};e.prototype.set=w(x(y(function(a,b){this.t("change:"+a,b);(l[a]||a)in this.a?this.a[l[a]||a]=b:this.d[a]=b;return this})));e.prototype.remove=function(a){this.t("change:"+a);return(l[a]||a)in this.a?delete this.a[l[a]||a]:delete this.d[a]};e.prototype.call=function(a){return(l[a]||a)in this.a?this.a[l[a]||a].apply(this.a,j(arguments,1)):this.d[a].apply(this,j(arguments,1))};e.prototype.properties=
function(){for(var a=JSON.parse(JSON.stringify(this.d)),b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];a[c.name]=this.a[l[c.name]||c.name]}for(var d in this.b)Object.prototype.hasOwnProperty.call(this.b,d)&&this.b[d]&&(a[d]=this.a[l[d]||d]);return a};e.prototype.persist=function(a){this.b[a]=!0};e.prototype.stopPersisting=function(a){this.b[a]=r};e.prototype.addListener=function(a,b){var c=this;this.a.addEventListener?this.a.addEventListener(a,function(b){return c.emit(a,F(b))},r):
this.a.attachEvent&&this.a.attachEvent("on"+a,function(){return c.emit(a,F(p.event))});return k.prototype.addListener.call(this,a,b)};e.prototype.splice=function(){var a,b,c,d,f,e,i,m;c=arguments[0];b=arguments[1];a=3<=arguments.length?j(arguments,2):[];for(d=f=0;0<=b?f<b:f>b;d=0<=b?++f:--f)this.a.removeChild(this.a.childNodes[c]),"object"===typeof this[c+d]&&this[c+d].v();e=this.a.childNodes[c]||h;d=i=0;for(m=a.length;i<m;d=++i){f=a[d];"object"===typeof f?(f.constructor===Array&&(f=a[d]=g.parse(f)),
d=f.a):d=o.createTextNode(f);if(d.parentNode&&1===d.parentNode.nodeType)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(d,e);"object"===typeof f&&f.u(this)}return D.apply(h,[this,c,b].concat(j(a)))};e.prototype.push=function(){return this.A.apply(this,[this.length].concat(j(arguments)))};e.prototype.pop=function(){return this.remove(this.length-1)};e.prototype.unshift=function(){return this.A.apply(this,[0].concat(arguments))};e.prototype.shift=function(){return this.remove(0)};
e.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1};Array.prototype.forEach.call("slice,sort,reverse,forEach,map,every,lastIndexOf,filter,some,reduce,reduceRight".split(","),function(a){e.prototype[a]=function(){return Array.prototype[a].apply(this,arguments)}});e.prototype.insert=function(a){this.splice.apply(this,[a,0].concat(j(arguments,1)));return this.length};e.prototype.remove=function(a){return this.splice(a,1)[0]};e.prototype.empty=function(){this.splice(0,
this.length);return this.length};e.prototype.insertSelf=function(a,b){a.insert(b,this);return this};e.prototype.removeSelf=function(){this.parent.remove(this.index());return this};e.prototype.index=function(){return this.parent.indexOf(this)};e.prototype.spliceText=function(a,b,c,d){if("string"!==typeof this[a])throw Error("Cannot splice non-text node.");this.a.childNodes[a].replaceData(b,c,d||"");this[a]=this.a.childNodes[a].data;return this};e.prototype.splitText=function(a,b){if("string"!==typeof this[a])throw Error("Cannot split non-text node.");
this.a.childNodes[a].splitText(b);return D(this,a,1,this[a].substr(0,b),this[a].substr(b))};e.prototype.query=function(a){return new g.TagrQuery(this,a)};e.prototype.findAll=function(a){return this.query(a).findAll()};e.prototype.find=function(a){return this.query(a).find()};e.prototype.toJSON=function(){var a={},b;for(b in this.b)Object.prototype.hasOwnProperty.call(this.b,b)&&this.b[b]&&(a[b]=this.a[l[b]||b]);for(b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];this.b[c.name]!==r&&
(a[c.name]=this.a[l[c.name]||c.name])}b=Array.prototype.map.call(this,function(a){return"string"===typeof a?a:a.toJSON()});return[this.c,a].concat(b)};e.prototype.toHTML=function(){var a=["<"+this.c],b;for(b in this.d)Object.prototype.hasOwnProperty.call(this.d,b)&&a.push(" "+s(b)+'="'+s(""+this.d[b])+'"');for(b in this.b)this.b[b]&&!(b in this.a.attributes)&&a.push(" "+s(b)+'="'+s(""+this.a[b])+'"');for(b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b],d=this.a[l[c.name]||c.name];a.push(" "+
s(c.name)+'="'+s(""+d)+'"')}a.push(">");if(-1==Array.prototype.indexOf.call(M,this.c)){for(b=0;b<this.length;b++)a.push("string"==typeof this[b]?s(this[b]):this[b].T());a.push("</"+this.c+">")}return a.join("")};g.TagrQuery=function(){function a(a,b){this.f=a;this.j=b}var b={};v(a,k);a.prototype.style=w(x(y(function(a,d){var f;f=f||"all";b[f]==h&&(b[f]=new B(f));f=b[f];f.insertRule!=h?f.insertRule("."+this.f.r()+" "+this.j+" { "+a+": "+d+" }",f.cssRules.length):f.addRule("."+this.f.r()+" "+this.j,
""+a+": "+d);return this})));a.prototype.addListener=function(a,b){var f=this;this.f.B(a,function(a){var c,e;c=z(f.f.a,f.j);n=a.target||a.srcElement;for(e=[];n!==f.f.a&&n;)0<=Array.prototype.indexOf.call(c,n)&&b.call(g.g(n),a),e.push(n=n.parentNode);return e},r);return k.prototype.addListener.call(this,a,b)};a.prototype.find=function(){return this.I()[0]};a.prototype.findAll=function(){var a,b,f,e,i;e=z(this.f.a,this.j);i=[];b=0;for(f=e.length;b<f;b++)a=e[b],i.push(g.g(a));return i};return a}();var H=
g.ElementAnchor=function(a,b){this.p=a;this.o=b};H.prototype.q=function(){return[this.p.a,this.o]};var I=g.TextAnchor=function(a,b,c){this.p=a;this.z=b;this.o=c};I.prototype.q=function(){return[this.p.a.childNodes[this.z],this.o]};convertAnchor=function(a){var b,c;c=a[0];a=a[1];if(1===c.nodeType)return!(b=g.g(c))?void 0:new H(b,a);if(g.g(c.parentNode)){b=0;for(n=c;n.previousSibling;)n=n.previousSibling,b++;return new I(el,b,a)}};g.view={getBox:function(a,b){var c,d,f,e;c=a.a.getBoundingClientRect();
if(b!=h)for(d in e=b.a.getBoundingClientRect(),e)f=e[d],c[d]-=f;return c},getStyle:function(a,b){var c;var d=a.a,f,e;p.getComputedStyle?(d=d.ownerDocument.defaultView.getComputedStyle(d,h),c=d!=h?d.getPropertyValue(b):void 0,c="opacity"===b&&""===c?"1":c):d.currentStyle&&(c=(f=d.currentStyle[b])!=h?f:d.currentStyle[E(b)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(e=[d.style.left,d.runtimeStyle.left],f=e[0],e=e[1],d.runtimeStyle.left=d.currentStyle.left,d.style.left="font-size"===b?"1em":c||0,c=
d.style.pixelLeft+"px",f=[f,e],d.style.left=f[0],d.runtimeStyle.left=f[1]));return c},selection:{has:function(){return Selection.O(p)},getOrigin:function(){return convertAnchor(Selection.M(p))},getFocus:function(){return convertAnchor(Selection.L(p))},getStart:function(){return convertAnchor(Selection.N(p))},getEnd:function(){return convertAnchor(Selection.K(p))},set:function(a,b){return Selection.R.apply(Selection,[p].concat(a.q(),b.q()))},remove:function(){return Selection.G(p)}}};e.prototype.useWhitespace=
function(a){a==h&&(a=!0);return a?this.style({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style(["white-space","word-wrap"],"")};e.prototype.setSelectable=function(a){a==h&&(a=!0);return this.style("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),a?"":"none")};g.w=function(a){p=a;o=a.document;z=K()};return g}();"undefined"!==typeof module?module.H=J:this.self&&J.w(this.self);
