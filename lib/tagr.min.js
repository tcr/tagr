/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var i=null,o=!1,J=function(){function K(){var a;a=function(){var a;if(j.querySelector!=i)return function(a,b){return a.querySelectorAll(b)};if(j.documentElement.currentStyle!=i)return a=new y,function(c,d){var e,h;e=(h=d.match(z))!=i?h[1]:void 0;a.addRule(d,"foo:bar");var f,p,g;p=e?c.all.fa(e):c.all;g=[];h=0;for(f=p.length;h<f;h++)e=p[h],"bar"===e.currentStyle.P&&g.push(e);a.removeRule(0);return g}};return function(b,c){return"undefined"!==typeof Sizzle?Sizzle(c,b):a()}}function B(){var a,b,c,d,e,
h,f,g,A;h=arguments[0];d=arguments[1];c=arguments[2];a=4<=arguments.length?[].slice.call(arguments,3):[];if(0>d||isNaN(d))throw"Invalid index";if(c){f=[];for(e=b=0;0<=c?b<c:b>c;e=0<=c?++b:--b)f.push(h[d+e]),delete h[d+e]}if(c>a.length){e=b=d+c;for(g=h.length;b<g;e=b+=1)h[e-c]=h[e]}else if(a.length>c)for(e=b=h.length+(a.length-c)-1;b>d;e=b+=-1)h[e]=h[e-(a.length-c)];if(a.length){e=g=0;for(A=a.length;g<A;e=++g)b=a[e],h[d+e]=b}h.length+=-c+a.length;return f}function u(a){return a.toLowerCase().replace(/\-[a-z]/g,
function(a){return a[1].toUpperCase()})}function v(a,b){function c(){this.constructor=a}c.prototype=b.prototype;a.prototype=new c}function C(a){return function(b,c){if("object"===typeof b){for(var d in b)a.call(this,d,b[d]);return this}return a.call(this,b,c)}}function D(a){return function(b,c){if("[object Array]"===Object.prototype.toString.call(b)){var d=this;b.forEach(function(b){a.call(d,b,c)});return this}return a.call(this,b,c)}}function E(a){return function(b,c){if("[object Array]"===Object.prototype.toString.call(c)){var d=
this;c.forEach(function(c){a.call(d,b,c)});return this}return a.call(this,b,c)}}function F(a){var b;if(b=a.match(z)){a={b:b[1]||"div",l:[],id:i};b=b[2].match(L)||[];for(var c=0,d=b.length;c<d;c++)switch(b[c].charAt(0)){case "#":a.id=b[c].substr(1);break;case ".":a.l.push(b[c].substr(1))}return a}}function m(){}function q(){this.k={}}function y(a){var b=j.createElement("style");b.type="text/css";b.media=a||"all";j.getElementsByTagName("head")[0].appendChild(b);return b.sheet||b.styleSheet}function g(a,
b){if("string"!=typeof a)throw new Exception("Invalid tag or selector argument passed to tagr.create: "+a);var c=F(a||""),d=j.createElement(c.b);c.l.length&&(d.className=c.l.join(" "));c.id&&(d.id=c.id);c=new f(d);c.set(b||{});2<arguments.length&&c.push.apply(c,[].slice.call(arguments,2));return c}function r(a){this.push.apply(this,a.className?a.className.replace(/^\s+|\s+$/g,"").split(/\s+/):[]);this.w=function(){node.className=this.toString()}}var k,j,G=function(){var a={"&":"&amp;","<":"&lt;",
">":"&gt;",'"':"&#34;","'":"&#39;"};return function(b){return b.replace(/[&<>'"]/g,function(b){return a[b]})}}(),l={"for":"htmlFor",H:"accessKey",L:"codeBase",Q:"frameBorder",R:"frameSpacing",$:"noWrap",Z:"maxLength","class":"className",ba:"readOnly",Y:"longDesc",ea:"tabIndex",ca:"rowSpan",M:"colSpan",enctype:"encType",X:"isMap",ha:"useMap",I:"cellPadding",J:"cellSpacing"},w=i,s=function(){var a;a=0;return function(b){var c;return(c=b.F)!=i?c:b.F=a++}}(),z=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/,L=/([:#.]+)([^:#.]+)/g;
m.prototype.o=function(a){this.d=this.d?this.d:{};return Object.prototype.hasOwnProperty.call(this.d,a)?this.d[a]:this.d[a]=[]};m.prototype.C=function(){this.z.apply(this,[].slice.call(arguments,0))};m.prototype.z=function(a,b){this.o(a).push(b)>this.s&&0!==this.s&&"undefined"!==typeof console&&console.warn("Possible EventEmitter memory leak detected. "+this.d[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");this.m("newListener",a,b);return this};m.prototype.m=function(){for(var a=
arguments[0],b=0,c=this.o(a);b<c.length;b++)c[b].apply(this,[].slice.call(arguments,1));this.o(a)};m.prototype.s=10;q.prototype.set=function(a,b){return this.k[s(a)]=b};q.prototype.get=function(a){return this.k[s(a)]};q.prototype.remove=function(a){return delete this.k[s(a)]};g.create=g;g.G=["data-tagr"];g.parse=function(a){var b,c,d,e,h;if("string"===typeof a)return a;e=a[0];d=a[1];c=3<=a.length?[].slice.call(a,2):[];return(h=g(e,d)).push.apply(h,function(){var a,d,e;e=[];a=0;for(d=c.length;a<d;a++)b=
c[a],e.push(g.parse(b));return e}())};g.ready=function(){function a(){var a;for(f=1;a=b.shift();)a()}var b=[],c,d=j,e=d.documentElement,h=e.doScroll,f=/^loade|^c/.test(d.readyState);d.addEventListener&&d.addEventListener("DOMContentLoaded",c=function(){d.removeEventListener("DOMContentLoaded",c,o);a()},o);h&&d.attachEvent("onreadystatechange",c=function(){/^c/.test(d.readyState)&&(d.detachEvent("onreadystatechange",c),a())});(ready=h?function(a){self!=top?f?a():b.push(a):function(){try{e.doScroll("left")}catch(b){return setTimeout(function(){ready(a)},
50)}a()}()}:function(a){f?a():b.push(a)})()};g.g=new q;g.f=function(a,b){var c;b==i&&(b=o);if(1!==a.nodeType)throw Error("Cannot create Tagr context of non-element");if((c=g.g.get(a))==i){if(!b)throw Error("No Tagr wrapper exists for this element.");g.g.set(a,c=new f(a))}return c};g.getContext=function(a){return g.f(a,!0)};g.writeContext=function(a,b){var c=F(a||"");j.write("<"+c.b+"></"+c.b+">");c=j.getElementsByTagName(c.b);c=g.getContext(c[c.length-1]);c.set(b||{});c.push.apply(c,[].slice.call(arguments,
2));return c};v(r,Array);r.prototype.remove=function(a){var b=0;if(-1!==(b=[].indexOf.call(this,""+a)))this.splice(b,1),this.w()};r.prototype.toString=function(){return this.join(" ")};var x={input:["value"]},f=g.TagrElement=function(a,b){this.a=a;this.parent=b;this.tag=this.a.nodeName.toLowerCase();this.classList=new r(a);this.h={};this.c={};if(x[this.b])for(var c=0;c<x[this.b].length;c++)this.aa(x[this.b][c]);var d=this.a.childNodes;this.length=d.length;for(c=0;c<this.length;c++){var e=d[c];this[c]=
1===e.nodeType?new f(e,this):e.nodeValue}};v(f,m);f.prototype.t=function(a){this.parent=a;g.g.set(this.a,this)};f.prototype.u=function(){delete this.parent;g.g.remove(this.a)};f.prototype.j="";f.prototype.r=function(){this.j||(this.a.className+=" "+(this.j="tagr-"+s(this.a)));return this.j};f.prototype.style=C(D(E(function(a,b){this.addRule(a,b);return this})));f.prototype.addRule=function(a,b){try{this.a.style[u(a)]=b.replace(/^\s+|\s+$/g,"")}catch(c){}return this};f.prototype.removeRule=function(a){try{this.a.style[u(a)]=
""}catch(b){}return this};f.prototype.get=function(a){return(l[a]||a)in this.a?this.a[l[a]||a]:this.h[a]};f.prototype.set=C(D(E(function(a,b){this.m("change:"+a,b);(l[a]||a)in this.a?this.a[l[a]||a]=b:this.h[a]=b;return this})));f.prototype.remove=function(a){this.m("change:"+a);return(l[a]||a)in this.a?delete this.a[l[a]||a]:delete this.h[a]};f.prototype.properties=function(){for(var a=JSON.parse(JSON.stringify(this.h)),b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];a[c.name]=this.a[l[c.name]||
c.name]}for(var d in this.c)Object.prototype.hasOwnProperty.call(this.c,d)&&this.c[d]&&(a[d]=this.a[l[d]||d]);return a};f.prototype.persist=function(a){this.c[a]=!0};f.prototype.stopPersisting=function(a){this.c[a]=o};f.prototype.addListener=function(a,b){var c=this;this.a.addEventListener?this.a.addEventListener(a,function(b){return c.emit(a,b)},o):this.a.attachEvent&&this.a.attachEvent("on"+a,function(){return c.emit(a,k.event)});return m.prototype.addListener.call(this,a,b)};f.prototype.splice=
function(){var a,b,c,d,e,f,t,p;c=arguments[0];b=arguments[1];a=3<=arguments.length?[].slice.call(arguments,2):[];for(d=e=0;0<=b?e<b:e>b;d=0<=b?++e:--e)this.a.removeChild(this.a.childNodes[c]),"object"===typeof this[c+d]&&this[c+d].u();f=this.a.childNodes[c]||i;d=t=0;for(p=a.length;t<p;d=++t){e=a[d];"object"===typeof e?(e.constructor===Array&&(e=a[d]=g.parse(e)),d=e.a):d=j.createTextNode(e);if(d.parentNode&&1===d.parentNode.nodeType)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(d,
f);"object"===typeof e&&e.t(this)}return B.apply(i,[this,c,b].concat([].slice.call(a)))};f.prototype.push=function(){return this.B.apply(this,[this.length].concat([].slice.call(arguments)))};f.prototype.pop=function(){return this.remove(this.length-1)};f.prototype.unshift=function(){return this.B.apply(this,[0].concat(arguments))};f.prototype.shift=function(){return this.remove(0)};f.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1};[].forEach.call("slice,sort,reverse,forEach,map,every,lastIndexOf,filter,some,reduce,reduceRight".split(","),
function(a){f.prototype[a]=function(){return Array.prototype[a].apply(this,arguments)}});f.prototype.insert=function(a){this.splice.apply(this,[a,0].concat([].slice.call(arguments,1)));return this.length};f.prototype.remove=function(a){return this.splice(a,1)[0]};f.prototype.empty=function(){this.splice(0,this.length);return this.length};f.prototype.insertSelf=function(a,b){a.insert(b,this);return this};f.prototype.removeSelf=function(){this.parent.remove(this.index());return this};f.prototype.index=
function(){return this.parent.indexOf(this)};f.prototype.spliceText=function(a,b,c,d){if("string"!==typeof this[a])throw Error("Cannot splice non-text node.");this.a.childNodes[a].replaceData(b,c,d||"");this[a]=this.a.childNodes[a].data;return this};f.prototype.splitText=function(a,b){if("string"!==typeof this[a])throw Error("Cannot split non-text node.");this.a.childNodes[a].splitText(b);return B(this,a,1,this[a].substr(0,b),this[a].substr(b))};f.prototype.query=function(a){return new g.TagrQuery(this,
a)};f.prototype.findAll=function(a){return this.query(a).findAll()};f.prototype.find=function(a){return this.query(a).find()};f.prototype.toJSON=function(){var a={},b;for(b in this.c)Object.prototype.hasOwnProperty.call(this.c,b)&&this.c[b]&&(a[b]=this.a[l[b]||b]);for(b=0;b<this.a.attributes.length;b++){var c=this.a.attributes[b];this.c[c.name]!==o&&(a[c.name]=this.a[l[c.name]||c.name])}b=[].map.call(this,function(a){return"string"===typeof a?a:a.toJSON()});return[this.b,a].concat(b)};f.prototype.toHTML=
function(){var a,b,c,d,e,f;b=["<"+this.b];f=this.D;d=0;for(e=f.length;d<e;d++)a=f[d],b.push(" "+G(a)+'="'+G(""+this.D.get(a))+'"');b.push.apply(b,[">"].concat([].slice.call(function(){var a,b,d;d=[];a=0;for(b=this.length;a<b;a++)c=this[a],d.push("string"===typeof c?c:c.ga());return d}.call(this)),["</"+this.b+">"]));return b.join("")};g.TagrQuery=function(){function a(a,b){this.e=a;this.i=b}var b={};v(a,m);a.prototype.style=function(a,d){var e;e==i&&(e="all");e=b[e]!=i?b[e]:b[e]=new y(e);e.insertRule!=
i?e.insertRule("."+this.e.r()+" "+this.i+" { "+a+": "+d+" }",e.cssRules.length):e.addRule("."+this.e.r()+" "+this.i,""+a+": "+d);return this};a.prototype.addListener=function(a,b){var e=this;this.e.C(a,function(a){var c,f;c=w(e.e.a,e.i);n=a.target||a.srcElement;for(f=[];n!==e.e.a&&n;)0<=[].indexOf.call(c,n)&&b.call(g.f(n),a),f.push(n=n.parentNode);return f},o);return m.prototype.addListener.call(this,a,b)};a.prototype.find=function(){return this.O()[0]};a.prototype.findAll=function(){var a,b,e,f,
j;f=w(this.e.a,this.i);j=[];b=0;for(e=f.length;b<e;b++)a=f[b],j.push(g.f(a));return j};return a}();var H=g.ElementAnchor=function(a,b){this.p=a;this.n=b};H.prototype.q=function(){return[this.p.a,this.n]};var I=g.TextAnchor=function(a,b,c){this.p=a;this.A=b;this.n=c};I.prototype.q=function(){return[this.p.a.childNodes[this.A],this.n]};convertAnchor=function(a){var b,c;c=a[0];a=a[1];if(1===c.nodeType)return!(b=g.f(c))?void 0:new H(b,a);if(g.f(c.parentNode)){b=0;for(n=c;n.previousSibling;)n=n.previousSibling,
b++;return new I(el,b,a)}};g.view={getBox:function(a,b){var c,d,e,f;c=a.a.getBoundingClientRect();if(b!=i)for(d in f=b.a.getBoundingClientRect(),f)e=f[d],c[d]-=e;return c},getStyle:function(a,b){var c;var d=a.a,e,f;k.getComputedStyle?(d=d.ownerDocument.defaultView.getComputedStyle(d,i),c=d!=i?d.getPropertyValue(b):void 0,c="opacity"===b&&""===c?"1":c):d.currentStyle&&(c=(e=d.currentStyle[b])!=i?e:d.currentStyle[u(b)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(f=[d.style.left,d.runtimeStyle.left],
e=f[0],f=f[1],d.runtimeStyle.left=d.currentStyle.left,d.style.left="font-size"===b?"1em":c||0,c=d.style.pixelLeft+"px",e=[e,f],d.style.left=e[0],d.runtimeStyle.left=e[1]));return c},selection:{has:function(){return Selection.W(k)},getOrigin:function(){return convertAnchor(Selection.U(k))},getFocus:function(){return convertAnchor(Selection.T(k))},getStart:function(){return convertAnchor(Selection.V(k))},getEnd:function(){return convertAnchor(Selection.S(k))},set:function(a,b){return Selection.da.apply(Selection,
[k].concat([].slice.call(a.q()),[].slice.call(b.q())))},remove:function(){return Selection.K(k)}}};f.prototype.useWhitespace=function(a){a==i&&(a=!0);return a?this.style({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style(["white-space","word-wrap"],"")};f.prototype.setSelectable=function(a){a==i&&(a=!0);return this.style("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),
a?"":"none")};g.v=function(a){k=a;j=a.document;w=K()};return g}();"undefined"!==typeof module?module.N=J:this.self&&J.v(this.self);
