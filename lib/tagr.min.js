/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var g=void 0,p=null;
(function(){function I(b,a){function c(){this.constructor=b}for(var f in a)P.call(a,f)&&(b[f]=a[f]);c.prototype=a.prototype;b.prototype=new c;b.o=a.prototype}var s,w,J,x,y,K,z,A,q,L,r,t,B,C,M,u,D,E,n,N,F,i,v,G,O,H,m=[].slice,P={}.hasOwnProperty,Q=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};x=function(){function b(){}b.name="EventEmitter";b.prototype.listeners=function(a){return this.hasOwnProperty.call(this.b!=p?this.b:this.b={},a)?this.b[a]:
this.b[a]=[]};b.prototype.on=function(){return this.addListener.apply(this,1<=arguments.length?m.call(arguments,0):[])};b.prototype.once=function(a,c){var b;return this.on(a,b=function(){var d;d=1<=arguments.length?m.call(arguments,0):[];c.apply(this,d);return this.removeListener(a,b)})};b.prototype.addListener=function(a,c){this.listeners(a).push(c)>this.i&&0!==this.i&&"undefined"!==typeof console&&console!==p&&console.warn("Possible EventEmitter memory leak detected. "+this.b[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");
this.emit("newListener",a,c);return this};b.prototype.removeListener=function(a,c){var b;-1!==(b=this.listeners(a).indexOf(c))&&this.listeners(a).splice(b,1);return this};b.prototype.removeAllListeners=function(a){var c,b,d;d=this.b||{};for(c in d)b=d[c],(a==p||a===c)&&b.splice(0,b.length);return this};b.prototype.emit=function(){var a,c,b,d,e,h;b=arguments[0];a=2<=arguments.length?m.call(arguments,1):[];h=this.listeners(b);d=0;for(e=h.length;d<e;d++)c=h[d],c.apply(this,a);return 0<this.listeners(b).length};
b.prototype.i=10;b.prototype.setMaxListeners=function(a){this.i=a};return b}();E=function(b){return function(a,c){var f,d;if("object"===typeof a){for(f in a)d=a[f],b.call(this,f,d);return this}return b.call(this,a,c)}};D=function(b){return function(a,c){var f,d,e;if("object"===typeof a&&(a!=p?a.length:g)!=p){d=0;for(e=a.length;d<e;d++)f=a[d],b.call(this,f,c);return this}return b.call(this,a,c)}};G=function(b){return function(a,c){var f,d,e;if("object"===typeof c&&(c!=p?c.length:g)!=p){d=0;for(e=c.length;d<
e;d++)f=c[d],b.call(this,a,f);return this}return b.call(this,a,c)}};s=function(){function b(a,c){var b,d,e;c==p&&(c={});d={};b=this;b.length=0;e=function(c,a){return function(){return a.apply(c,arguments)}};this.get=e(a,function(a){return(c!=p?c.get:g)!=p?c.get(a):d["@"+a]});this.set=e(a,E(D(G(function(a,e){Object.prototype.hasOwnProperty.call(d,"@"+a)||(b[b.length++]=a);c!=p&&"function"===typeof c.set&&c.set(a,e);d["@"+a]=e;return this}))));this.remove=e(a,function(a){var e,k,l,o;if(Object.prototype.hasOwnProperty.call(d,
"@"+a)){e=l=0;for(o=this.length;l<o;e=++l)if(k=this[e],k===a){k=l=e;for(o=b.length-1;e<=o?l<o:l>o;k=e<=o?++l:--l)b[k]=b[k+1];break}b.length--;c!=p&&"function"===typeof c.remove&&c.remove(a);delete d["@"+a]}return this})}b.name="ArrayHash";return b}();v=function(b){return b.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})};F=function(){var b,a,c,f,d,e,h,j,k;e=arguments[0];f=arguments[1];c=arguments[2];b=4<=arguments.length?m.call(arguments,3):[];if(0>f||isNaN(f))throw"Invalid index";
if(c){h=[];for(d=a=0;0<=c?a<c:a>c;d=0<=c?++a:--a)h.push(e[f+d]),delete e[f+d]}if(c>b.length){d=a=f+c;for(j=e.length;a<j;d=a+=1)e[d-c]=e[d]}else if(b.length>c)for(d=a=e.length+(b.length-c)-1;a>f;d=a+=-1)e[d]=e[d-(b.length-c)];if(b.length){d=j=0;for(k=b.length;j<k;d=++j)a=b[d],e[f+d]=a}e.length+=-c+b.length;return h};B=function(){var b;b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};return function(a){return a.replace(/[&<>'"]/g,function(a){return b[a]})}}();this.Stylesheet=A=function(b){var a;
b==p&&(b="all");a=document.createElement("style");a.type="text/css";a.media=b;document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet};this.Script=function(){var b;b=document.createElement("script");b.src="about:blank";return document.getElementsByTagName("head")[0].appendChild(b)};y={"for":"htmlFor",z:"accessKey",F:"codeBase",I:"frameBorder",J:"frameSpacing",S:"noWrap",R:"maxLength","class":"className",U:"readOnly",Q:"longDesc",X:"tabIndex",V:"rowSpan",G:"colSpan",enctype:"encType",
P:"isMap",$:"useMap",B:"cellPadding",C:"cellSpacing"};r=function(){var b,a,c,f;f=/^loade|c/.test(document.readyState);c=[];b=function(a){var b;f=!0;for(b=[];a=c.shift();)b.push(a());return b};if(document.documentElement.doScroll)return document.attachEvent("onreadystatechange",a=function(){if(/^c/.test(document.readyState))return document.detachEvent("onreadystatechange",a),b()}),function(a){return self!==top?f?a():c.push(a):function(){try{testEl.doScroll("left")}catch(c){return setTimeout(function(){return ready(a)},
50)}return a()}()};if(document.addEventListener!=p)return document.addEventListener("DOMContentLoaded",a=function(){document.removeEventListener("DOMContentLoaded",a,!1);return b()},!1),function(a){return f?a():c.push(a)}}();M=function(b,a){var c,f,d;if(window.getComputedStyle)return c=b.ownerDocument.defaultView.getComputedStyle(b,p),c=c!=p?c.getPropertyValue(a):g,"opacity"===a&&""===c?"1":c;if(b.currentStyle)return c=(f=b.currentStyle[a])!=p?f:b.currentStyle[v(a)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&
(d=[b.style.left,b.runtimeStyle.left],f=d[0],d=d[1],b.runtimeStyle.left=b.currentStyle.left,b.style.left="font-size"===a?"1em":c||0,c=b.style.pixelLeft+"px",f=[f,d],b.style.left=f[0],b.runtimeStyle.left=f[1]),c};C=function(){var b;b=function(){var a;if(document.querySelector!=p)return function(a,b){return a.querySelectorAll(b)};if(document.documentElement.currentStyle!=p)return a=new A,function(c,b){var d,e;d=(e=b.match(z))!=p?e[1]:g;a.addRule(b,"foo:bar");var h,j,k;j=d?c.all.Y(d):c.all;k=[];e=0;
for(h=j.length;e<h;e++)d=j[e],"bar"===d.currentStyle.H&&k.push(d);a.removeRule(0);return k}}();return function(a,c){return"undefined"!==typeof Sizzle?Sizzle(c,a):b(a,c)}}();u=function(){var b;b=0;return function(a){var c;return(c=a.u)!=p?c:a.u=b++}}();w=function(){function b(){this.j={}}b.name="DomMap";b.prototype.set=function(a,c){return this.j[u(a)]=c};b.prototype.get=function(a){return this.j[u(a)]};b.prototype.remove=function(a){return delete this.j[u(a)]};return b}();z=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/;
K=/([:#.]+)([^:#.]+)/g;N=function(b){var a,c,f,d;if(a=b.match(z)){b={h:a[1]||"div",k:[],id:p};d=a[2].match(K)||[];c=0;for(f=d.length;c<f;c++)switch(a=d[c],a[0]){case "#":b.id=a.substr(1);break;case ".":b.k.push(a.substr(1))}return b}};this.tagr=i=function(b,a){var c,f;a==p&&(a={});f=N(b||"");c=document.createElement(f.h);f.k.length&&(c.className=f.k.join(" "));f.id&&(c.id=f.id);return(new q(c)).set(a)};i.v=["data-tagr"];i.parse=function(b){var a,c,f,d,e;if("string"===typeof b)return b;d=b[0];f=b[1];
c=3<=b.length?m.call(b,2):[];return(e=i(d,f)).append.apply(e,function(){var b,d,e;e=[];b=0;for(d=c.length;b<d;b++)a=c[b],e.push(i.parse(a));return e}())};i.ready=r;i.e=new w;i.d=function(b,a){var c;a==p&&(a=!1);if(1!==b.nodeType)throw Error("Cannot create Tagr context of non-element");if((c=i.e.get(b))==p){if(!a)throw Error("No Tagr wrapper exists for this element.");i.e.set(b,c=new q(b))}return c};i.getContext=function(b){return i.d(b,!0)};i.writeContext=function(b,a){var c;b==p&&(b="div");a==p&&
(a={});document.write("<"+b+"></"+b+">");c=document.getElementsByTagName(b);return i.getContext(c[c.length-1]).set(a)};i.TagrElement=q=function(b){function a(c,b){var d,e,h,j,k,l=this;this.a=c;this.parent=b;this.tag=this.a.nodeName.toLowerCase();this.props=new s(this,{set:function(a,c){var b;l.emit("change:"+a,c);return l.a[(b=y[a])!=p?b:a]=c},get:function(a){var c;return l.a[(c=y[a])!=p?c:a]},remove:function(a){return l.a.removeAttribute(a)}});j=this.a.attributes;e=0;for(h=j.length;e<h;e++)d=j[e],
this.props.set(d.name,d.value);this.classes=new s(this,{set:function(a,c){var b;c==p&&(c=!0);return l.a.className=""+function(){var c,d,e,f;e=this.classes;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],b!==a&&f.push(b);return f}.call(l).join("")+" "+(c?a:"")+" "+l.f},get:function(a){return!!l.a.className.match(RegExp("\\b"+a+"\\b"))},remove:function(a){var c;return l.a.className=function(){var b,d,e,f;e=this.classes;f=[];b=0;for(d=e.length;b<d;b++)c=e[b],c!==a&&f.push(c);return f}.call(l).join("")}});j=this.a.className.match(/\S+/g)||
[];e=0;for(h=j.length;e<h;e++)d=j[e],this.classes.set(d);this.style=new s(this,{set:function(a,c){try{return l.a.style[v(a)]=c.replace(/^\s*([\S\s]*?)\s*$/,"$1")}catch(b){}},get:function(a){return l.a.style[v(a)]},remove:function(a){return delete l.a.style[v(a)]}});this.length=this.a.childNodes.length;k=this.a.childNodes;e=h=0;for(j=k.length;h<j;e=++h)d=k[e],this[e]=1===d.nodeType?new a(d,this):d.w}I(a,b);a.name="TagrElement";a.prototype.q=function(a){this.parent=a;i.e.set(this.a,this)};a.prototype.r=
function(){delete this.parent;i.e.remove(this.a)};a.prototype.f="";a.prototype.p=function(){this.f||(this.a.className+=" "+(this.f="tagr-"+u(this.a)));return this.f};a.prototype.get=function(a){return this.props.get(a)};a.prototype.set=function(a,b){return this.props.set(a,b)};a.prototype.remove=function(a){return this.props.remove(a)};a.prototype.addListener=function(c,b){var d=this;this.a.addEventListener?this.a.addEventListener(c,function(a){return d.emit(c,a)},!1):this.a.attachEvent&&this.a.attachEvent("on"+
c,function(){return d.emit(c,window.event)});return a.o.addListener.call(this,c,b)};a.prototype.splice=function(){var a,b,d,e,h,j,k,l;d=arguments[0];b=arguments[1];a=3<=arguments.length?m.call(arguments,2):[];for(e=h=0;0<=b?h<b:h>b;e=0<=b?++h:--h)this.a.removeChild(this.a.childNodes[d]),"object"===typeof this[d+e]&&this[d+e].r();j=this.a.childNodes[d]||p;e=k=0;for(l=a.length;k<l;e=++k){h=a[e];"object"===typeof h?(h.constructor===Array&&(h=a[e]=i.parse(h)),e=h.a):e=document.createTextNode(h);if(e.parentNode&&
1===e.parentNode.nodeType)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(e,j);"object"===typeof h&&h.q(this)}return F.apply(p,[this,d,b].concat(m.call(a)))};a.prototype.append=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[this.length,0].concat(m.call(a)));return this};a.prototype.prepend=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[0,0].concat(m.call(a)));return this};a.prototype.remove=
function(a){this.splice(a,1);return this};a.prototype.insert=function(){var a,b;b=arguments[0];a=2<=arguments.length?m.call(arguments,1):[];this.splice.apply(this,[b,0].concat(m.call(a)));return this};a.prototype.empty=function(){this.splice(0,this.length);return this};a.prototype.indexOf=function(a){var b,d,e,h;d=e=0;for(h=this.length;e<h;d=++e)if(b=this[d],b===a)return d;return-1};a.prototype.appendSelf=function(a){a.append(this);return this};a.prototype.prependSelf=function(a){a.prepend(this);
return this};a.prototype.removeSelf=function(){this.parent.remove(this.index());return this};a.prototype.insertSelf=function(a,b){a.insert(b,this);return this};a.prototype.index=function(){return this.parent.indexOf(this)};a.prototype.spliceText=function(a,b,d,e){e==p&&(e="");if("string"!==typeof this[a])throw Error("Cannot splice non-text node.");this.a.childNodes[a].replaceData(b,d,e);this[a]=this.a.childNodes[a].data;return this};a.prototype.splitText=function(a,b){if("string"!==typeof this[a])throw Error("Cannot split non-text node.");
this.a.childNodes[a].splitText(b);return F(this,a,1,this[a].substr(0,b),this[a].substr(b))};a.prototype.select=function(a){return new i.TagrQuery(this,a)};a.prototype.find=function(a){return this.select(a).find()};a.prototype.toJSON=function(){var a;return[this.h,this.A].concat(m.call(function(){var b,d,e;e=[];b=0;for(d=this.length;b<d;b++)a=this[b],e.push("string"===typeof a?a:a.toJSON());return e}.call(this)))};a.prototype.toHTML=function(){var a,b,d,e,h,j;b=["<"+this.h];j=this.t;e=0;for(h=j.length;e<
h;e++)a=j[e],b.push(" "+B(a)+'="'+B(""+this.t.get(a))+'"');b.push.apply(b,[">"].concat(m.call(function(){var a,b,c;c=[];a=0;for(b=this.length;a<b;a++)d=this[a],c.push("string"===typeof d?d:d.Z());return c}.call(this)),["</"+this.h+">"]));return b.join("")};return a}(x);H=["forEach","slice","map"];w=function(b){q.prototype[b]=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];return Array.prototype[b].apply(this,a)}};r=0;for(O=H.length;r<O;r++)n=H[r],w(n);i.TagrQuery=function(){var b,a;
a={};b=function(b){b==p&&(b="all");return a[b]!=p?a[b]:a[b]=new A(b)};return function(a){function f(a,c){var f=this;this.c=a;this.g=c;this.style=new s(this,{set:E(D(G(function(a,c){var d;d=b();d.insertRule!=p?d.insertRule("."+f.c.p()+" "+f.g+" { "+a+": "+c+" }",d.cssRules.length):d.addRule("."+f.c.p()+" "+f.g,""+a+": "+c);return f})))})}I(f,a);f.name="TagrQuery";f.prototype.addListener=function(a,b){var c=this;this.c.T(a,function(a){var d,f;d=C(c.c.a,c.g);n=a.target||a.srcElement;for(f=[];n!==c.c.a&&
n;)0<=Q.call(d,n)&&b.call(i.d(n),a),f.push(n=n.parentNode);return f},!1);return f.o.addListener.call(this,a,b)};f.prototype.find=function(){var a,b,c,f,k;f=C(this.c.a,this.g);k=[];b=0;for(c=f.length;b<c;b++)a=f[b],k.push(i.d(a));return k};return f}(x)}();J=function(){function b(a,b){this.m=a;this.l=b}b.name="ElementAnchor";b.prototype.n=function(){return[this.m.a,this.l]};return b}();L=function(){function b(a,b,f){this.m=a;this.s=b;this.l=f}b.name="TextAnchor";b.prototype.n=function(){return[this.m.a.childNodes[this.s],
this.l]};return b}();t=function(b){var a,c;c=b[0];b=b[1];if(1===c.nodeType)return!(a=i.d(c))?g:new J(a,b);if(i.d(c.parentNode)){a=0;for(n=c;n.previousSibling;)n=n.previousSibling,a++;return new L(el,a,b)}};i.view={getBox:function(b,a){var c,f,d,e;c=b.a.getBoundingClientRect();if(a!=p)for(f in e=a.a.getBoundingClientRect(),e)d=e[f],c[f]-=d;return c},getStyle:function(b,a){return M(b.a,a)},selection:{has:function(){return Selection.O(window)},getOrigin:function(){return t(Selection.M(window))},getFocus:function(){return t(Selection.L(window))},
getStart:function(){return t(Selection.N(window))},getEnd:function(){return t(Selection.K(window))},set:function(b,a){return Selection.W.apply(Selection,[window].concat(m.call(b.n()),m.call(a.n())))},remove:function(){return Selection.D(window)}}};q.prototype.useWhitespace=function(b){b==p&&(b=!0);return b?this.style.set({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style.set(["white-space","word-wrap"],"")};q.prototype.setSelectable=function(b){b==
p&&(b=!0);return this.style.set("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),b?"":"none")}}).call(this);
