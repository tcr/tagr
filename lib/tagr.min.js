/*
 Tagr, HTML manipulation for webapps. MIT Licensed.
*/
var g=null;
(function(){function E(b,a){function c(){this.constructor=b}for(var e in a)K.call(a,e)&&(b[e]=a[e]);c.prototype=a.prototype;b.prototype=new c;b.j=a.prototype}var t,u,w,x,F,y,z,p,q,A,G,r,B,v,n,H,I,j,s,C,J,D,m=[].slice,K={}.hasOwnProperty,L=[].indexOf||function(b){for(var a=0,c=this.length;a<c;a++)if(a in this&&this[a]===b)return a;return-1};w=function(){function b(){}b.name="EventEmitter";b.prototype.listeners=function(a){return this.hasOwnProperty.call(this.b!=g?this.b:this.b={},a)?this.b[a]:this.b[a]=
[]};b.prototype.on=function(){return this.addListener.apply(this,1<=arguments.length?m.call(arguments,0):[])};b.prototype.once=function(a,c){var b;return this.on(a,b=function(){var d;d=1<=arguments.length?m.call(arguments,0):[];c.apply(this,d);return this.removeListener(a,b)})};b.prototype.addListener=function(a,c){this.listeners(a).push(c)>this.f&&0!==this.f&&"undefined"!==typeof console&&console!==g&&console.warn("Possible EventEmitter memory leak detected. "+this.b[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.");
this.emit("newListener",a,c);return this};b.prototype.removeListener=function(a,c){var b;-1!==(b=this.listeners(a).indexOf(c))&&this.listeners(a).splice(b,1);return this};b.prototype.removeAllListeners=function(a){var c,b,d;d=this.b||{};for(c in d)b=d[c],(a==g||a===c)&&b.splice(0,b.length);return this};b.prototype.emit=function(){var a,c,b,d,f,h;b=arguments[0];a=2<=arguments.length?m.call(arguments,1):[];h=this.listeners(b);d=0;for(f=h.length;d<f;d++)c=h[d],c.apply(this,a);return 0<this.listeners(b).length};
b.prototype.f=10;b.prototype.setMaxListeners=function(a){this.f=a};return b}();v=function(b){return function(a,c){var e,d;if(!(1<arguments.length||"object"!==typeof a)){for(e in a)d=a[e],b.call(this,e,d);return this}return b.call(this,a,c)}};B=function(b){return function(a,c){var e,d,f;if("object"===typeof a&&(a!=g?a.length:void 0)!=g){d=0;for(f=a.length;d<f;d++)e=a[d],b.call(this,e,c);return this}return b.call(this,a,c)}};C=function(b){return function(a,c){var e,d,f;if("object"===typeof c&&(c!=g?
c.length:void 0)!=g){d=0;for(f=c.length;d<f;d++)e=c[d],b.call(this,a,e);return this}return b.call(this,a,c)}};t=function(){function b(a,c){var b,d,f;c==g&&(c={});d={};b=this;b.length=0;f=function(c,a){return function(){return a.apply(c,arguments)}};this.get=f(a,function(a){return(c!=g?c.get:void 0)!=g?c.get(a):d["@"+a]});this.set=f(a,v(B(C(function(a,f){Object.prototype.hasOwnProperty.call(d,"@"+a)||(b[b.length++]=a);c!=g&&"function"===typeof c.set&&c.set(a,f);d["@"+a]=f;return this}))));this.remove=
f(a,function(a){var f,i,l,o;if(Object.prototype.hasOwnProperty.call(d,"@"+a)){f=l=0;for(o=this.length;l<o;f=++l)if(i=this[f],i===a){i=l=f;for(o=b.length-1;f<=o?l<o:l>o;i=f<=o?++l:--l)b[i]=b[i+1];break}b.length--;c!=g&&"function"===typeof c.remove&&c.remove(a);delete d["@"+a]}return this})}b.name="ArrayHash";return b}();s=function(b){return b.toLowerCase().replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()})};I=function(){var b,a,c,e,d,f,h,k,i;f=arguments[0];e=arguments[1];c=arguments[2];b=4<=
arguments.length?m.call(arguments,3):[];if(0>e||isNaN(e))throw"Invalid index";if(c){h=[];for(d=a=0;0<=c?a<c:a>c;d=0<=c?++a:--a)h.push(f[e+d]),delete f[e+d]}if(c>b.length){d=a=k=e+c;for(i=f.length;k<=i?a<i:a>i;d=k<=i?++a:--a)f[d-c]=f[d]}else if(b.length>c)for(d=a=k=f.length+b.length-1;k<=e?a<e:a>e;d=k<=e?++a:--a)f[d]=f[d-b.length];if(b.length){d=k=0;for(i=b.length;k<i;d=++k)a=b[d],f[e+d]=a}f.length+=-c+b.length;return h};this.Stylesheet=z=function(b){var a;b==g&&(b="all");a=document.createElement("style");
a.type="text/css";a.media=b;return document.getElementsByTagName("head")[0].appendChild(a)};this.Script=function(){var b;b=document.createElement("script");b.src="about:blank";return document.getElementsByTagName("head")[0].appendChild(b)};x={"for":"htmlFor",r:"accessKey",v:"codeBase",A:"frameBorder",B:"frameSpacing",G:"noWrap",F:"maxLength","class":"className",H:"readOnly",D:"longDesc",J:"tabIndex",I:"rowSpan",w:"colSpan",enctype:"encType",C:"isMap",L:"useMap",t:"cellPadding",u:"cellSpacing"};q=
function(){var b,a,c,e;e=/^loade|c/.test(document.readyState);c=[];b=function(a){var b;e=!0;for(b=[];a=c.shift();)b.push(a());return b};if(document.documentElement.doScroll)return document.attachEvent("onreadystatechange",a=function(){if(/^c/.test(document.readyState))return document.detachEvent("onreadystatechange",a),b()}),function(a){return self!==top?e?a():c.push(a):function(){try{testEl.doScroll("left")}catch(c){return setTimeout(function(){return ready(a)},50)}return a()}()};if(document.addEventListener!=
g)return document.addEventListener("DOMContentLoaded",a=function(){document.removeEventListener("DOMContentLoaded",a,!1);return b()},!1),function(a){return e?a():c.push(a)}}();G=function(b,a){var c,e,d;if(window.getComputedStyle)return c=b.ownerDocument.defaultView.getComputedStyle(b,g),c=c!=g?c.getPropertyValue(a):void 0,"opacity"===a&&""===c?"1":c;if(b.currentStyle)return c=(e=b.currentStyle[a])!=g?e:b.currentStyle[s(a)],!/^\d+(?:px)?$/i.test(ret)&&/^\d/.test(ret)&&(d=[b.style.left,b.runtimeStyle.left],
e=d[0],d=d[1],b.runtimeStyle.left=b.currentStyle.left,b.style.left="font-size"===a?"1em":c||0,c=b.style.pixelLeft+"px",e=[e,d],b.style.left=e[0],b.runtimeStyle.left=e[1]),c};A=function(){var b;if(document.querySelector!=g)return function(a,c){return a.querySelectorAll(c)};if(document.documentElement.currentStyle!=g)return b=new z,function(a,c){var e,d;e=(d=c.match(y))!=g?d[1]:void 0;b.addRule(c,"foo:bar");var f,h,k;h=e?a.K(e):a.all;k=[];d=0;for(f=h.length;d<f;d++)e=h[d],"bar"===e.currentStyle.z&&
k.push(e);b.removeRule(0);return k}}();r=function(){var b;b=0;return function(a){var c;return(c=a.o)!=g?c:a.o=b++}}();u=function(){function b(){this.g={}}b.name="DomMap";b.prototype.set=function(a,c){return this.g[r(a)]=c};b.prototype.get=function(a){return this.g[r(a)]};b.prototype.remove=function(a){return delete this.g[r(a)]};return b}();y=/(?:^|\s+)([^.#\[\]:\s]*)(\S*)\s*$/;F=/([:#.]+)([^:#.]+)/g;H=function(b){var a,c,e,d;if(a=b.match(y)){b={k:a[1]||"div",h:[],id:g};d=a[2].match(F)||[];c=0;for(e=
d.length;c<e;c++)switch(a=d[c],a[0]){case "#":b.id=a.substr(1);break;case ".":b.h.push(a.substr(1))}return b}};this.tagr=j=function(b,a){var c,e;a==g&&(a={});e=H(b||"");c=document.createElement(e.k);e.h.length&&(c.className=e.h.join(" "));e.id&&(c.id=e.id);return(new p(c)).set(a)};j.p=["data-tagr"];j.parse=function(b){var a,c,e,d,f;if("string"===typeof b)return b;d=b[0];e=b[1];c=3<=b.length?m.call(b,2):[];return(f=j(d,e)).append.apply(f,function(){var b,d,e;e=[];b=0;for(d=c.length;b<d;b++)a=c[b],
e.push(j.parse(a));return e}())};j.ready=q;j.d=new u;j.e=function(b,a){var c;a==g&&(a=!1);if(1!==b.nodeType)throw Error("Cannot create Tagr context of non-element");if((c=j.d.get(b))==g){if(!a)throw Error("No Tagr wrapper exists for this element.");j.d.set(b,c=new p(b))}return c};j.getContext=function(b){return j.e(b,!0)};j.writeContext=function(b,a){var c;b==g&&(b="div");a==g&&(a={});document.write("<"+b+"></"+b+">");c=document.getElementsByTagName(b);return j.getContext(c[c.length-1]).set(a)};j.TagrElement=
p=function(b){function a(c,b){var d,f,h,k,i,l=this;this.a=c;this.parent=b;this.tag=this.a.nodeName.toLowerCase();this.classes=new t(this,{set:function(a,c){var b;c==g&&(c=!0);return l.a.className=function(){var c,d,e,f;e=this.classes;f=[];c=0;for(d=e.length;c<d;c++)b=e[c],b!==a&&f.push(b);return f}.call(l).join("")+(c?" "+a:"")},get:function(a){return!!l.a.className.match(RegExp("\\b"+a+"\\b"))},remove:function(a){var c;return l.a.className=function(){var b,d,e,f;e=this.classes;f=[];b=0;for(d=e.length;b<
d;b++)c=e[b],c!==a&&f.push(c);return f}.call(l).join("")}});k=this.a.className.match(/\S+/g)||[];f=0;for(h=k.length;f<h;f++)d=k[f],this.classes.set(d);this.style=new t(this,{set:function(a,c){return l.a.style[s(a)]=c},get:function(a){return l.a.style[s(a)]},remove:function(a){return delete l.a.style[s(a)]}});this.length=this.a.childNodes.length;i=this.a.childNodes;f=h=0;for(k=i.length;h<k;f=++h)d=i[f],this[f]=1===d.nodeType?new a(d,this):d.q}E(a,b);a.name="TagrElement";a.prototype.l=function(a){this.parent=
a;j.d.set(this.a,this)};a.prototype.m=function(){delete this.parent;j.d.remove(this.a)};a.prototype.n=function(){this.a.hasAttribute("data-tagr")||this.a.setAttribute("data-tagr",r(this.a));return this.a.getAttribute("data-tagr")};a.prototype.get=function(a){var b;return this.a[(b=x[a])!=g?b:a]};a.prototype.set=v(function(a,b){var d;this.emit("change:"+a,b);this.a[(d=x[a])!=g?d:a]=b;return this});a.prototype.remove=function(a){this.a.removeAttribute(a);return this};a.prototype.addListener=function(b,
e){var d=this;this.a.addEventListener?this.a.addEventListener(b,function(a){return d.emit(b,a)},!1):this.a.attachEvent&&this.a.attachEvent("on"+b(function(){return d.emit(b,window.event)}));return a.j.addListener.call(this,b,e)};a.prototype.splice=function(){var a,b,d,f,h,k,i,l;d=arguments[0];b=arguments[1];a=3<=arguments.length?m.call(arguments,2):[];for(f=h=0;0<=b?h<b:h>b;f=0<=b?++h:--h)this.a.removeChild(this.a.childNodes[d]),"object"===typeof this[d+f]&&this[d+f].m();k=this.a.childNodes[d];f=
i=0;for(l=a.length;i<l;f=++i){h=a[f];"object"===typeof h?(h.constructor===Array&&(h=a[f]=j.parse(h)),f=h.a):f=document.createTextNode(h);if(f.parentNode)throw Error("Must remove element before appending elsewhere.");this.a.insertBefore(f,k);"object"===typeof h&&h.l(this)}return I.apply(g,[this,d,b].concat(m.call(a)))};a.prototype.append=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[this.length,0].concat(m.call(a)));return this};a.prototype.prepend=function(){var a;
a=1<=arguments.length?m.call(arguments,0):[];this.splice.apply(this,[0,0].concat(m.call(a)));return this};a.prototype.remove=function(a){this.splice(a,1);return this};a.prototype.insert=function(){var a,b;b=arguments[0];a=2<=arguments.length?m.call(arguments,1):[];this.splice.apply(this,[b,0].concat(m.call(a)));return this};a.prototype.empty=function(){this.splice(0,this.length);return this};a.prototype.appendSelf=function(a){a.append(this);return this};a.prototype.prependSelf=function(a){a.prepend(this);
return this};a.prototype.removeSelf=function(){this.parent.remove(this.index());return this};a.prototype.insertSelf=function(a,b){a.insert(b,this);return this};a.prototype.index=function(){return this.parent.indexOf(this)};a.prototype.select=function(a){return new j.TagrQuery(this,a)};a.prototype.find=function(a){return this.select(a).find()};a.prototype.toJSON=function(){var a;return[this.k,this.s].concat(m.call(function(){var b,d,f;f=[];b=0;for(d=this.length;b<d;b++)a=this[b],f.push("string"===
typeof a?a:a.toJSON());return f}.call(this)))};return a}(w);D=["forEach","slice","map","indexOf"];u=function(b){p.prototype[b]=function(){var a;a=1<=arguments.length?m.call(arguments,0):[];return Array.prototype[b].apply(this,a)}};q=0;for(J=D.length;q<J;q++)n=D[q],u(n);j.TagrQuery=function(){var b,a;a={};b=function(b){var e;b==g&&(b="all");if(a[b]!=g)return a[b];e=new z(b);return a[b]=e.sheet||e.styleSheet};return function(a){function e(a,c){var e=this;this.c=a;this.i=c;this.style=new t(this,{set:v(B(C(function(a,
c){var d,f;d="[data-tagr='"+e.c.n()+"'] "+e.i;f=b();f.insertRule(""+d+" { "+a+": "+c+" }",f.cssRules.length);return e})))})}E(e,a);e.name="TagrQuery";e.prototype.addListener=function(a,b){var c=this;this.c.a.addEventListener(a,function(a){var d,e;d=A(c.c.a,c.i);n=a.target;for(e=[];n!==c.c.a&&n;)0<=L.call(d,n)&&b.call(j.e(n),a),e.push(n=n.parentNode);return e},!1);return e.j.addListener.call(this,a,b)};e.prototype.find=function(){var a,b,c,e,i;e=A(this.c.a,this.i);i=[];b=0;for(c=e.length;b<c;b++)a=
e[b],i.push(j.e(a));return i};return e}(w)}();j.view={getBox:function(b,a){var c,e,d,f;c=b.a.getBoundingClientRect();if(a!=g)for(e in f=a.a.getBoundingClientRect(),f)d=f[e],c[e]-=d;return c},getStyle:function(b,a){return G(b.a,a)}};p.prototype.useWhitespace=function(b){b==g&&(b=!0);return b?this.style.set({"white-space":["pre","pre-wrap","-moz-pre-wrap","-pre-wrap","-o-pre-wrap"],"word-wrap":"break-word"}):this.style.set(["white-space","word-wrap"],"")};p.prototype.setSelectable=function(b){b==g&&
(b=!0);return this.style.set("-webkit-touch-callout,-webkit-user-select,-khtml-user-select,-moz-user-select,-ms-user-select,user-select".split(","),b?"":"none")}}).call(this);
